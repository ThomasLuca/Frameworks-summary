<!doctype html>
<html >
<head>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!--[if lt IE 9]>
                <script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
        <![endif]-->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />

    <!-- <link rel="stylesheet" type="text/css" href="template.css" /> -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/template.css" />

    <link href="https://vjs.zencdn.net/5.4.4/video-js.css" rel="stylesheet" />

    <script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
    <!-- <script type='text/javascript' src='menu/js/jquery.cookie.js'></script> -->
    <!-- <script type='text/javascript' src='menu/js/jquery.hoverIntent.minified.js'></script> -->
    <!-- <script type='text/javascript' src='menu/js/jquery.dcjqaccordion.2.7.min.js'></script> -->

    <!-- <link href="menu/css/skins/blue.css" rel="stylesheet" type="text/css" /> -->
    <!-- <link href="menu/css/skins/graphite.css" rel="stylesheet" type="text/css" /> -->
    <!-- <link href="menu/css/skins/grey.css" rel="stylesheet" type="text/css" /> -->
  
    <!-- <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->
        
  
    <!-- <script src="script.js"></script> -->
  
    <!-- <script src="jquery.sticky-kit.js "></script> -->
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.cookie.js'></script>
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.hoverIntent.minified.js'></script>
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.dcjqaccordion.2.7.min.js'></script>

    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/blue.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/graphite.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/grey.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/ryangrose/easy-pandoc-templates@948e28e5/css/elegant_bootstrap.css" rel="stylesheet" type="text/css" />
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  
    <script src="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/script.js"></script>
  
    <script src="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/jquery.sticky-kit.js"></script>
    <meta name="generator" content="pandoc" />
  <title>Frameworks summary</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>

    
    <div class="navbar navbar-static-top">
    <div class="navbar-inner">
      <div class="container">
        <span class="doc-title">Frameworks summary</span>
        <ul class="nav pull-right doc-info">
                            </ul>
      </div>
    </div>
  </div>
    <div class="container">
    <div class="row">
            <div id="TOC" class="span3">
        <div class="well toc">

        <ul>
        <li><a href="#frameworks-summary"
        id="toc-frameworks-summary">Frameworks summary</a>
        <ul>
        <li><a href="#rest" id="toc-rest">1. REST</a>
        <ul>
        <li><a href="#http-refresher" id="toc-http-refresher">1.1 HTTP
        refresher</a></li>
        <li><a href="#rest-webservices" id="toc-rest-webservices">1.2
        Rest webservices</a></li>
        <li><a href="#rest-webservices-java-springboot"
        id="toc-rest-webservices-java-springboot">1.3 Rest webservices:
        Java (<em>Springboot</em>)</a></li>
        <li><a href="#testing-webservices"
        id="toc-testing-webservices">1.4 Testing webservices</a></li>
        <li><a href="#webservices-security"
        id="toc-webservices-security">1.5 Webservices security</a></li>
        </ul></li>
        <li><a href="#orm" id="toc-orm">2. ORM</a>
        <ul>
        <li><a href="#orm-object-relational-mapping"
        id="toc-orm-object-relational-mapping">2.1 ORM: Object
        Relational Mapping</a></li>
        <li><a href="#jpa-in-spring" id="toc-jpa-in-spring">2.2 JPA in
        Spring</a></li>
        <li><a href="#orm-inheritance" id="toc-orm-inheritance">2.3 ORM
        Inheritance</a></li>
        <li><a href="#orm-associations-value-objects"
        id="toc-orm-associations-value-objects">2.4 ORM associations:
        value-objects</a></li>
        <li><a href="#orm-associations-relations"
        id="toc-orm-associations-relations">2.5 ORM associations:
        relations</a></li>
        <li><a href="#how-does-jpa-work" id="toc-how-does-jpa-work">2.6
        How does JPA work?</a></li>
        </ul></li>
        <li><a href="#node.js" id="toc-node.js">3. Node.js</a>
        <ul>
        <li><a href="#example-http-server-in-node.js"
        id="toc-example-http-server-in-node.js">3.1 Example HTTP-server
        in Node.js</a></li>
        <li><a href="#routing" id="toc-routing">3.2 Routing</a></li>
        <li><a href="#the-node.js-system"
        id="toc-the-node.js-system">3.3 The Node.js system</a></li>
        <li><a href="#express.js" id="toc-express.js">3.4
        Express.js</a></li>
        </ul></li>
        <li><a href="#websockets" id="toc-websockets">4.
        Websockets</a></li>
        <li><a href="#reactive-rest-webservices"
        id="toc-reactive-rest-webservices">5. Reactive REST
        webservices</a>
        <ul>
        <li><a href="#data-streams" id="toc-data-streams">5.1 Data
        streams</a></li>
        <li><a href="#observer-and-observables"
        id="toc-observer-and-observables">5.2 Observer and
        observables</a></li>
        <li><a href="#reactor-java" id="toc-reactor-java">5.3 Reactor
        Java</a></li>
        </ul></li>
        <li><a href="#jdbc" id="toc-jdbc">6. JDBC</a>
        <ul>
        <li><a href="#jdbc-drivers" id="toc-jdbc-drivers">6.1 JDBC
        drivers</a></li>
        <li><a href="#jdbc-example" id="toc-jdbc-example">6.2 JDBC
        Example</a></li>
        <li><a href="#sql-injection" id="toc-sql-injection">6.3
        SQL-injection</a></li>
        <li><a href="#driver-vs-datasource"
        id="toc-driver-vs-datasource">6.4 Driver vs DataSource</a></li>
        <li><a href="#orm-vs-jdbc" id="toc-orm-vs-jdbc">6.5 ORM vs
        JDBC</a></li>
        </ul></li>
        <li><a href="#ado.net" id="toc-ado.net">7. ADO.NET</a>
        <ul>
        <li><a href="#ado.net-architecture"
        id="toc-ado.net-architecture">7.1 ADO.NET Architecture</a></li>
        <li><a href="#dataset" id="toc-dataset">7.2 DataSet</a></li>
        <li><a href="#dataprovider" id="toc-dataprovider">7.3
        DataProvider</a></li>
        <li><a href="#data-manipulation" id="toc-data-manipulation">7.4
        Data Manipulation</a></li>
        <li><a href="#dataadapter" id="toc-dataadapter">7.5
        DataAdapter</a></li>
        <li><a href="#transactions" id="toc-transactions">7.6
        Transactions</a></li>
        </ul></li>
        <li><a href="#rest-services-in-.net"
        id="toc-rest-services-in-.net">8. REST-services in .NET</a>
        <ul>
        <li><a href="#web-api" id="toc-web-api">8.1 Web API</a></li>
        <li><a href="#openapi-specification"
        id="toc-openapi-specification">8.2 OpenAPI
        specification</a></li>
        </ul></li>
        <li><a href="#asp.net-core-mvc" id="toc-asp.net-core-mvc">9.
        ASP.NET Core MVC</a>
        <ul>
        <li><a href="#model-view-controller-pattern-mvc"
        id="toc-model-view-controller-pattern-mvc">Model-View-Controller-pattern
        (MVC)</a></li>
        <li><a href="#globalization-and-localization"
        id="toc-globalization-and-localization">Globalization and
        Localization</a></li>
        <li><a href="#security" id="toc-security">Security</a></li>
        </ul></li>
        <li><a href="#security-1" id="toc-security-1">10. Security</a>
        <ul>
        <li><a href="#authentication-2" id="toc-authentication-2">10.1
        Authentication</a></li>
        <li><a href="#most-common-vulnerabilities"
        id="toc-most-common-vulnerabilities">10.2 Most common
        vulnerabilities</a></li>
        </ul></li>
        </ul></li>
        </ul>

        </div>
      </div>
            <div class="span9">

      
      <h1 id="frameworks-summary">Frameworks summary</h1>
<h2 id="rest">1. REST</h2>
<h3 id="http-refresher">1.1 HTTP refresher</h3>
<ul>
<li>Client-server protocol</li>
<li>Transport protocol: TCP on port 80</li>
<li>Request-response</li>
</ul>
<h4 id="http-request">HTTP Request</h4>
<p>Request types:</p>
<ul>
<li>GET</li>
<li>POST</li>
<li>PUT</li>
<li>DELETE</li>
<li>HEAD</li>
<li>OPTIONS</li>
</ul>
<p>Statuscodes:</p>
<ul>
<li>1xx: Informative</li>
<li>2xx: Success</li>
<li>3xx: Redirection</li>
<li>4xx: Client error</li>
<li>5xx: Server error</li>
</ul>
<h3 id="rest-webservices">1.2 Rest webservices</h3>
<p>REST stands for Representational State Transfer. It’s an
architectural style used for designing networked applications,
especially web services. REST relies on a client-server architecture
where the client interacts with the server via requests to access and
manipulate resources on the server</p>
<ul>
<li><strong>Client-server</strong></li>
<li><strong>Stateless</strong>: server doesn’t store any client
context</li>
<li><strong>Uniform interface</strong>: independent of type of
client</li>
<li><strong>Cacheable</strong>: responses from REST service can specify
to cache for a specified period. (using the <code>Cache-Control</code>
header field)</li>
<li><strong>Layered system</strong>: client doesn’t now which layer it
is connected to</li>
<li><strong>Code on demand</strong>: Content of message can also be
code</li>
<li>Resource-based: can be any data or service that the app exposes,
resources is identifiable via a URI</li>
<li>CRUD operations: Must support GET, POST, PUT, DELETE methods.</li>
<li>Representational resources: could be represented by multiple
representations (JSON, XML, …)</li>
</ul>
<h4 id="uri-uniform-resource-identifier">URI (Uniform Resource
Identifier)</h4>
<p>URI’s are hierarchical structures that represent a resource on which
CRUD actions can be performed.</p>
<p>hierarchical:
<code>http://www.myservice.org/discussions/{year}/{day}/{month}/{topic}</code></p>
<p>It is also possible to add parameters to the URI to filter or sort on
a resources:
<code>http://www.myservice.org/discussions?region=USA&amp;year=2023</code></p>
<h4 id="glory-of-rest">Glory of REST</h4>
<figure>
<img src="./img/glory-of-rest.png" alt="Glory of REST" />
<figcaption aria-hidden="true">Glory of REST</figcaption>
</figure>
<h5 id="level-0-the-swamp-of-pox">Level 0: The swamp of pox</h5>
<ul>
<li>Plain Old XML (POX)</li>
<li>One endpoint</li>
<li>HTTP only as transport</li>
<li>Remote procedure invocation
(<code>POST &lt;openSlotRequest</code>)</li>
</ul>
<h5 id="level-1-resources">Level 1: Resources</h5>
<ul>
<li>Multiple endpoints</li>
<li>Arguments in body (<code>POST &lt;appointmentRequest</code>)</li>
</ul>
<h5 id="level-2-http-methods">Level 2: HTTP-methods</h5>
<ul>
<li>HTTP-methods as CRUD (<code>GET ?date=20231224</code>)</li>
<li>HTTP-statuscodes as response
(<code>200 OK &lt;openSlotList</code>)</li>
</ul>
<h5 id="level-3-hypermedia-controls">Level 3: Hypermedia controls</h5>
<ul>
<li>HATEOAS (Hypertext As The Engine Of Application State)</li>
<li>Links to other resources in response</li>
<li>Selfdocumenting protocol</li>
</ul>
<h3 id="rest-webservices-java-springboot">1.3 Rest webservices: Java
(<em>Springboot</em>)</h3>
<p><strong>Why springboot?</strong></p>
<p>Spring avoids a lot of manual configuration and is easy to manage
dependently.</p>
<h4 id="spring-architecture">Spring architecture</h4>
<figure>
<img src="./img/spring-architecture.png"
alt="Architecture REST API in Spring" />
<figcaption aria-hidden="true">Architecture REST API in
Spring</figcaption>
</figure>
<ol type="1">
<li>Spring-framework receives HTTP-req and determines which
<em>method</em> of which <em>controller</em> has to get called.</li>
<li>(Opt) Convert JSON in body to specific object</li>
<li>(Opt) Validate input values of object</li>
<li>Call method of <em>controller</em> with object as param</li>
<li><em>Controller</em> calls underlying logic</li>
<li>Logic interacts with data-layer</li>
<li>Result of <em>controller</em> gets serialized to JSON</li>
<li>HTTP-response gets generated (possibly with JSON-object in
body)</li>
</ol>
<h4 id="get-controller">GET controller</h4>
<div class="sourceCode" id="cb1"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">springframework</span><span class="op">.</span><span class="im">web</span><span class="op">.</span><span class="im">bind</span><span class="op">.</span><span class="im">annotation</span><span class="op">.*;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="at">@RestController</span> <span class="co">// Indicate that this class is a RestController</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="at">@RequestMapping</span><span class="op">(</span><span class="st">&quot;agenda&quot;</span><span class="op">)</span> <span class="co">//The path to access agendas (eg: localhost:8080/agenda)</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> AgendaController <span class="op">{</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> Agenda agenda<span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  pubic <span class="fu">AgendaController</span><span class="op">(</span>Agenda agenda<span class="op">)</span> <span class="op">{</span> <span class="kw">this</span><span class="op">.</span><span class="fu">agenda</span> <span class="op">=</span> agenda<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">@GetMapping</span> <span class="co">// Indicate that method handles Get-requests</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="bu">Collection</span><span class="op">&lt;</span>AgendaItem<span class="op">&gt;</span> <span class="fu">agendaFromNow</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> agenda<span class="op">.</span><span class="fu">getAgendaItem</span><span class="op">(</span><span class="kw">new</span> <span class="bu">Date</span><span class="op">());</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<ul>
<li><code>@RestController</code>:
<ul>
<li>Normal class</li>
<li>Wrapped in a <code>servlet</code> ( a class that handles requests,
processes them and reply back with a response)</li>
<li>REST-service</li>
</ul></li>
<li><code>@RequestMapping</code>:
<ul>
<li>Specifies which path a REST-service needs to handle.</li>
</ul></li>
<li><code>@GetMapping</code>:
<ul>
<li>Specifies which HTTP-method a method response to</li>
<li>Result is automatically converted to JSON</li>
<li>Can have a path as parameter (eg
<code>GetMapping("/id/{id}")</code>)
<ul>
<li>Param can be retrieved using <code>@RequestParam("id")</code></li>
</ul></li>
</ul></li>
<li><code>@PostMapping</code>:
<ul>
<li>Body can be retrieved using
<code>@RequestBody AgendaItem item</code></li>
</ul></li>
</ul>
<h5 id="dependency-injection">Dependency injection</h5>
<p>DI is needed to make the Agenda class (dependency) available to the
to <code>RestController</code>.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Component</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> Agenda <span class="op">{</span><span class="kw">...</span><span class="op">}</span></span></code></pre></div>
<h5 id="method-response-status">Method response status</h5>
<p>A REST-method typically returns a <code>ResponseEntity</code> (along
with a message).</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="at">@GetMapping</span><span class="op">(</span><span class="st">&quot;/age&quot;</span><span class="op">)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>ResponseEntity<span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;</span> <span class="fu">age</span><span class="op">(</span><span class="at">@RequestParam</span><span class="op">(</span><span class="st">&quot;yearOfBirth&quot;</span><span class="op">)</span> <span class="dt">int</span> yearOfBirth<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span><span class="fu">invalidAge</span><span class="op">(</span>yearOfBirth<span class="op">))</span> <span class="op">{</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> ResponseEntity<span class="op">&lt;&gt;(</span><span class="st">&quot;Invalid year of birth&quot;</span><span class="op">,</span> HttpStatus<span class="op">.</span><span class="fu">BAD_REQUEST</span><span class="op">);</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">new</span> ResponseEntity<span class="op">&lt;&gt;(</span><span class="st">&quot;YOB is &quot;</span> <span class="op">+</span> yearOfBirth<span class="op">,</span> HttpStatus<span class="op">.</span><span class="fu">OK</span><span class="op">);</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>It is also possible to couple a statuscode to an exception:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="at">@ResponseStatus</span><span class="op">(</span>code <span class="op">=</span> HttpStatus<span class="op">.</span><span class="fu">BAD_REQUEST</span><span class="op">)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CustomException <span class="kw">extends</span> <span class="bu">RuntimeException</span> <span class="op">{}</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="at">@PostMapping</span><span class="op">()</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="at">@ResponseStatus</span><span class="op">(</span>HttpStatus<span class="op">.</span><span class="fu">CREATED</span><span class="op">)</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">storeEmployee</span><span class="op">(</span><span class="at">@RequestBody</span> Employee employee<span class="op">)</span> <span class="op">{</span><span class="kw">...</span><span class="op">}</span></span></code></pre></div>
<p>Here the <code>ResponseStatus</code> will automatically return a 201
if the creation of employee was successful.</p>
<p>Finally it is also common to respond with a URI.</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="at">@PostMapping</span><span class="op">(</span><span class="st">&quot;/user/{username}&quot;</span><span class="op">)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> ResponseEntity<span class="op">&lt;</span><span class="bu">Void</span><span class="op">&gt;</span> <span class="fu">createTodo</span><span class="op">(</span><span class="at">@PathVariable</span> <span class="bu">String</span> username<span class="op">,</span> <span class="at">@RequestBody</span> Todo todo<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  todo<span class="op">.</span><span class="fu">setUsername</span><span class="op">(</span>username<span class="op">);</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  Todo createdTodo <span class="op">=</span> toJpaRepo<span class="op">.</span><span class="fu">save</span><span class="op">(</span>todo<span class="op">);</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="bu">URI</span> uri <span class="op">=</span> ServletUriComponentsBuilder<span class="op">.</span><span class="fu">fromCurrentRequest</span><span class="op">()</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">path</span><span class="op">(</span><span class="st">&quot;/id&quot;</span><span class="op">).</span><span class="fu">buildAndExpand</span><span class="op">(</span>createdTodo<span class="op">.</span><span class="fu">getId</span><span class="op">()).</span><span class="fu">toUri</span><span class="op">();</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> ResponseEntity<span class="op">.</span><span class="fu">created</span><span class="op">(</span>uri<span class="op">).</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="testing-webservices">1.4 Testing webservices</h3>
<h4 id="unit-tests-junit">Unit tests (Junit)</h4>
<p><strong>Fixture</strong>:</p>
<ul>
<li>Fixed context</li>
<li>baseline state</li>
</ul>
<p>Four phases:</p>
<ol type="1">
<li>Setup: Prepare text fixture</li>
<li>Exercise: Interact with system to research</li>
<li>Verify: Verify if it behaves as expected</li>
<li>Tear down: Break down text fixture to original state</li>
</ol>
<div class="sourceCode" id="cb7"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="at">@ExtendWith</span><span class="op">(</span>SpringExtension<span class="op">.</span><span class="fu">class</span><span class="op">)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="at">@SpringBootTest</span><span class="op">(</span>webEnvironment <span class="op">=</span> WebEnvironment<span class="op">.</span><span class="fu">RANDOM_PORT</span><span class="op">)</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="at">@AutoConfigureWebTestClient</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="at">@ActiveProfile</span><span class="op">(</span><span class="st">&quot;test&quot;</span><span class="op">)</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> RestAgendaApplicationTest <span class="op">{</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Autowired</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> WebTestClient webClient<span class="op">;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Test</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="dt">void</span> <span class="fu">testGetAllRepos</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    WebTestClient<span class="op">.</span><span class="fu">get</span><span class="op">().</span><span class="fu">uri</span><span class="op">(</span><span class="st">&quot;/api/repos&quot;</span><span class="op">)</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">accept</span><span class="op">(</span>MediaType<span class="op">.</span><span class="fu">APPLICATION_JSON_UTF8</span><span class="op">)</span>  <span class="co">// Set header</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">exchange</span><span class="op">()</span>                               <span class="co">// Send message</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">expectStatus</span><span class="op">().</span><span class="fu">isOk</span><span class="op">()</span>                    <span class="co">// Check status</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">expectHeader</span><span class="op">().</span><span class="fu">contentType</span><span class="op">(</span>MediaType<span class="op">.</span><span class="fu">APPLICATION_JSON_UTF8</span><span class="op">)</span> <span class="co">// Check header</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">expectedBodyList</span><span class="op">(</span>Repo<span class="op">.</span><span class="fu">class</span><span class="op">)</span>             <span class="co">// Check body</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The <code>@ActiveProfile</code> annotation is optional but is very
useful. It let’s us use a different bean configured specifically for
testing purposes.</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Component</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="at">@Profile</span><span class="op">(</span><span class="st">&quot;test&quot;</span><span class="op">)</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> DummyDao <span class="kw">implements</span> Dao <span class="op">{</span><span class="kw">...</span><span class="op">}</span></span></code></pre></div>
<h3 id="webservices-security">1.5 Webservices security</h3>
<h4 id="authentication">Authentication</h4>
<p>Configure login information</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Configuration</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="at">@EnableWebSecurity</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> SecurityConfig <span class="op">{</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Bean</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> UserDetailsService <span class="fu">userDetailsService</span><span class="op">(</span>BCryptPasswordEncoder bCryptPasswordEncoder<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    InMemoryUserDetailsManager manager <span class="op">=</span> <span class="kw">new</span> <span class="fu">InMemoryUserDetailsManager</span><span class="op">();</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    manager<span class="op">.</span><span class="fu">createUser</span><span class="op">(</span>User<span class="op">.</span><span class="fu">withUsername</span><span class="op">(</span><span class="st">&quot;user&quot;</span><span class="op">)</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">password</span><span class="op">(</span>bCryptPasswordEncoder<span class="op">.</span><span class="fu">encode</span><span class="op">(</span><span class="st">&quot;userPass&quot;</span><span class="op">))</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">roles</span><span class="op">(</span><span class="st">&quot;USER&quot;</span><span class="op">)</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">build</span><span class="op">());</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    manager<span class="op">.</span><span class="fu">createUser</span><span class="op">(</span>User<span class="op">.</span><span class="fu">withUsername</span><span class="op">(</span><span class="st">&quot;admin&quot;</span><span class="op">)</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">password</span><span class="op">(</span>bCryptPasswordEncoder<span class="op">.</span><span class="fu">encode</span><span class="op">(</span><span class="st">&quot;adminPass&quot;</span><span class="op">))</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">roles</span><span class="op">(</span><span class="st">&quot;USER&quot;</span><span class="op">,</span> <span class="st">&quot;ADMIN&quot;</span><span class="op">)</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">build</span><span class="op">());</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> manager<span class="op">;</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="kw">...</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="authorization">Authorization</h4>
<p>Assign roles to users and restrict certain roles from performing
certain actions.</p>
<figure>
<img src="./img/authorization.png" alt="Authorization" />
<figcaption aria-hidden="true">Authorization</figcaption>
</figure>
<p><strong>Allow certain roles webservice:</strong>
(<code>anyRequest()</code>)</p>
<p><strong>Allow certain roles on some paths:</strong>
(<code>requestMatchers(path)</code>)</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Configuration</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="at">@EnableWebSecurity</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> SecurityConfig <span class="op">{</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Bean</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> SecurityFilterChain <span class="fu">securityFilterChain</span><span class="op">(</span>HttpSecurity http<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Exception</span> <span class="op">{</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    http</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">authorizeHttpRequests</span><span class="op">((</span>authz<span class="op">)</span> <span class="op">-&gt;</span> authz</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">requestMatchers</span><span class="op">(</span><span class="st">&quot;/api/admin/**&quot;</span><span class="op">).</span><span class="fu">hasRole</span><span class="op">(</span><span class="st">&quot;ADMIN&quot;</span><span class="op">)</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">requestMatchers</span><span class="op">(</span><span class="st">&quot;/api/user/**&quot;</span><span class="op">).</span><span class="fu">hasRole</span><span class="op">(</span><span class="st">&quot;USER&quot;</span><span class="op">)</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">anyRequest</span><span class="op">().</span><span class="fu">authenticated</span><span class="op">()</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>      <span class="op">);</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> http<span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="kw">...</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Allow certain roles on some webservice methods:</strong>
(<code>@EnableMethodSecurity()</code>)</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Configuration</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="at">@EnableMethodSecurity</span><span class="op">(</span>prePostEnabled <span class="op">=</span> <span class="kw">true</span><span class="op">,</span> securedEnabled <span class="op">=</span> <span class="kw">true</span><span class="op">,</span> jsr250Enabled <span class="op">=</span> <span class="kw">true</span><span class="op">)</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> SecurityConfig <span class="op">{</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">@RolesAllowed</span><span class="op">(</span><span class="st">&quot;ROLE_VIEWER&quot;</span><span class="op">)</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="bu">String</span> <span class="fu">getUser</span><span class="op">();</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">@RolesAllowed</span><span class="op">({</span> <span class="st">&quot;ROLE_ADMIN&quot;</span><span class="op">,</span> <span class="st">&quot;ROLE_EDITOR&quot;</span> <span class="op">})</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="dt">void</span> <span class="fu">deleteUser</span><span class="op">();</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h5 id="request-vs-method-authorization">Request vs method
authorization</h5>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 39%" />
<col style="width: 26%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Request</th>
<th>Method</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Type</td>
<td>Rough</td>
<td>Detailed</td>
</tr>
<tr class="even">
<td>Place of config</td>
<td>In config class</td>
<td>on specific method</td>
</tr>
<tr class="odd">
<td>Type of config</td>
<td>With lambda expression</td>
<td>With annotations</td>
</tr>
<tr class="even">
<td>Definition of auth</td>
<td>In code</td>
<td>Spring Expression Language</td>
</tr>
</tbody>
</table>
<h4 id="csrf-cross-site-request-forgery">CSRF: Cross Site Request
Forgery</h4>
<p>CSRF is an attack where an attacker tricks a user’s browser into
making an unintended and unauthorized request to a different website,
exploiting the user’s authenticated session.</p>
<p><strong>How to defend against CSRF?</strong></p>
<p>Make distinction between real and fake HTTP-request by using a
<strong>Synchronizer Token Pattern</strong> or
<strong>SameSite-attribute cookie</strong>.</p>
<p>Both methods generate a token for the client on login. Then every
time the client interacts with the server, the client includes that
token in its request. On every request, the server will validate if it
received a valid token. These tokens have a certain expiration date to
avoid problems upon token theft.</p>
<blockquote>
<p>💡: In Spring, CSRF security is enabled by default.</p>
</blockquote>
<hr />
<h2 id="orm">2. ORM</h2>
<h3 id="orm-object-relational-mapping">2.1 ORM: Object Relational
Mapping</h3>
<p>ORM is a programming technique that allows devs to work with objects
in the code while transparently persisting and retrieving data from a
relational database. It allows devs to define how objects/classes map to
database tables and vice versa. Each object corresponds to a table in
the database.</p>
<h4 id="object-relational-impedance-mismatch">Object-relational
impedance mismatch</h4>
<p>There are a lot of concepts in OOP that resembles the structure of
Relational databases: - Identities - Relations - Inheritance</p>
<p>There are a couple requirements to be able to map an object to a
DB.</p>
<ol type="1">
<li>Object must have same <em>Primary Key</em> as DB table.</li>
<li>Relationships should be the same</li>
<li>Each field of the object should map to column in the database</li>
</ol>
<h4 id="orm-in-java">ORM in java</h4>
<p>Using the <em>JPA (Java Persistence API)</em>. Every dataclass must
be a Java Bean.</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Entity</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="at">@Table</span><span class="op">(</span>name <span class="op">=</span> <span class="st">&quot;sportclub&quot;</span><span class="op">)</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> Sportclub <span class="op">{</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">Long</span> id<span class="op">;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">String</span> name<span class="op">;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Id</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">@GeneratedValue</span><span class="op">(</span>strategy<span class="op">=</span>GenerationType<span class="op">.</span><span class="fu">IDENTITY</span><span class="op">)</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="bu">Long</span> <span class="fu">getId</span><span class="op">()</span> <span class="op">{</span> <span class="cf">return</span> id<span class="op">;</span> <span class="op">}</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setId</span><span class="op">(</span><span class="bu">Long</span> id<span class="op">)</span> <span class="op">{</span> <span class="kw">this</span><span class="op">.</span><span class="fu">id</span> <span class="op">=</span> id<span class="op">;</span> <span class="op">}</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="bu">String</span> <span class="fu">getName</span><span class="op">()</span> <span class="op">{</span> <span class="cf">return</span> name<span class="op">;</span> <span class="op">}</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setName</span><span class="op">(</span><span class="bu">String</span> name<span class="op">)</span> <span class="op">{</span> <span class="kw">this</span><span class="op">.</span><span class="fu">name</span> <span class="op">=</span> name<span class="op">;</span> <span class="op">}</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>There are a couple different strategies to assign a new Primary
Key:</p>
<ul>
<li>AUTO: Automatically choose strategy</li>
<li>IDENTITY: Relies on an auto-incremented column in the database</li>
<li>SEQUENCE: Utilizes a database sequence to generate primary key</li>
<li>TABLE: Requires an extra table to keep track of the next available
id</li>
</ul>
<h3 id="jpa-in-spring">2.2 JPA in Spring</h3>
<figure>
<img src="./img/jpa-config.png" alt="JPA configuration" />
<figcaption aria-hidden="true">JPA configuration</figcaption>
</figure>
<h4 id="jpa-repository">JPA Repository</h4>
<p>The <code>JpaRepository</code> is an interface that is a
CRUD-repository with extra functionalities for performing database
operations.</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Typically defined in a single file (like ProductRepository.java)</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">interface</span> ProductRepository <span class="kw">extends</span> JpaRepository<span class="op">&lt;</span>Product<span class="op">,</span> <span class="bu">Long</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>      <span class="bu">List</span><span class="op">&lt;</span>Product<span class="op">&gt;</span> <span class="fu">findByCategory</span><span class="op">(</span><span class="bu">String</span> category<span class="op">);</span> <span class="co">// Optional custom user-defined queries</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Example usage of build-in queries:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ProductDao.java</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="at">@Service</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> ProductDao<span class="op">{</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="dt">final</span> ProductRepository repo<span class="op">;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">ProductDao</span><span class="op">(</span>ProductRepository repository<span class="op">)</span> <span class="op">{</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">repo</span> <span class="op">=</span> repository<span class="op">;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="bu">List</span><span class="op">&lt;</span>Product<span class="op">&gt;</span> <span class="fu">getProductsByCategory</span><span class="op">(</span><span class="bu">String</span> category<span class="op">)</span> <span class="op">{</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> repo<span class="op">.</span><span class="fu">findByCategory</span><span class="op">(</span>category<span class="op">);</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> Product <span class="fu">getProductById</span><span class="op">(</span><span class="dt">long</span> id<span class="op">)</span> <span class="op">{</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> repo<span class="op">.</span><span class="fu">findById</span><span class="op">(</span>id<span class="op">).</span><span class="fu">orElse</span><span class="op">(</span><span class="kw">null</span><span class="op">);</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="dt">void</span> <span class="fu">addProduct</span><span class="op">(</span>Product p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    repo<span class="op">.</span><span class="fu">save</span><span class="op">(</span>addProduct<span class="op">);</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>List of build-in methods:</p>
<ul>
<li><code>save</code>: save new object</li>
<li><code>findAll</code>: return all entities</li>
<li><code>findAllById</code>: return all with certain id</li>
<li><code>flush</code>: write changes to DB</li>
<li><code>saveAll</code>: Save list of objects</li>
<li><code>delete</code>, <code>deleteAll</code>: remove
entity/entities</li>
<li><code>existById</code>: does entity exist?</li>
</ul>
<blockquote>
<p>⚠️: Using a JPA requires some configuration in
<code>application.properties</code></p>
</blockquote>
<pre class="text"><code>spring.datasource.url=jdbc:mysql://localhost:3306/dudosdb?serverTimezone=UTC
spring.datasource.username=TLuca
spring.datasource.password=&lt;redacted&gt;</code></pre>
<h3 id="orm-inheritance">2.3 ORM Inheritance</h3>
<p>There are different annotation to indicate what type of inheritance
an object is subject to:</p>
<ul>
<li><code>@Inheritance(strategy = ...)</code>: Sets how entities are
stored in the DB (default = <code>SINGLE_TABLE</code>)</li>
<li><code>@DiscriminatorColumn(name = "...", discriminatorType= ...)</code>:
Defines a column that distinguishes entity types in a single table</li>
</ul>
<p>Inheritance strategy:</p>
<ul>
<li><code>@DiscriminatorValue("K")</code>: Assigns a specific value to
differentiate an entity type in a single table inheritance setup</li>
<li><code>@PrimaryKeyJoinColumn(name = "...")</code>: Maps a parent
table’s primary key as a foreign key in the child table in joined table
inheritance.</li>
</ul>
<h3 id="orm-associations-value-objects">2.4 ORM associations:
value-objects</h3>
<p>Associations:</p>
<ul>
<li>Direction:
<ul>
<li>Unidirectional</li>
<li>Bidirectional</li>
</ul></li>
<li>Multiplicity:
<ul>
<li>1-to-1</li>
<li>1-to-many</li>
<li>many-to-many</li>
</ul></li>
</ul>
<p>Value-objects criteria:</p>
<ul>
<li>Value-obj belongs to just one entity</li>
<li>Entity disappears -&gt; value-object disappears</li>
<li>An entity has an <em>identifier</em></li>
</ul>
<h4 id="value-object-example">Value-object example</h4>
<figure>
<img src="./img/example-value-obj.png" alt="Example value-obj" />
<figcaption aria-hidden="true">Example value-obj</figcaption>
</figure>
<p>It doesn’t make sense to save the value-object (<code>Address</code>)
in a separate table. So we can store the <code>Address</code> in the
same table in multiple <code>Embedded columns</code>.</p>
<p>We would also like to make an association to a separate table
containing all the email addresses.</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Embeddable</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> Address <span class="op">{</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">String</span> street<span class="op">;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">String</span> city<span class="op">;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">String</span> state<span class="op">;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">String</span> zipCode<span class="op">;</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Getters, setters, constructors, etc.</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="at">@Entity</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="at">@Table</span><span class="op">(</span>name <span class="op">=</span> <span class="st">&quot;sportclub&quot;</span><span class="op">)</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> sportclub <span class="op">{</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Id</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">Long</span> id<span class="op">;</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">String</span> name<span class="op">;</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Embedded</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> Address address<span class="op">;</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">@ElementCollection</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">@CollectionTable</span><span class="op">(</span>name <span class="op">=</span> <span class="st">&quot;emailaddresses&quot;</span><span class="op">,</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  joinColumns <span class="op">=</span> <span class="at">@JoinColumn</span><span class="op">(</span>name <span class="op">=</span> <span class="st">&quot;sportclub&quot;</span><span class="op">))</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Column</span><span class="op">(</span>name<span class="op">=</span><span class="st">&quot;email&quot;</span><span class="op">)</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="orm-associations-relations">2.5 ORM associations: relations</h3>
<p>Different mappings of associations of entities:</p>
<ol type="1">
<li>One-to-One Relationship:
<ul>
<li><code>@OneToOne</code>: Defines a one-to-one relationship between
two entities.</li>
<li><code>@JoinColumn</code>: Specifies the column used for joining two
entities in a one-to-one relationship.</li>
</ul></li>
<li>One-to-Many Relationship:
<ul>
<li><code>@OneToMany</code>: Represents a one-to-many relationship
between two entities.</li>
<li><code>@JoinColumn</code> (within <code>@OneToMany</code>): Specifies
the column in the “many” side entity to join with the “one” side
entity.</li>
</ul></li>
<li>Many-to-One Relationship:
<ul>
<li><code>@ManyToOne</code>: Specifies a many-to-one relationship
between two entities.</li>
<li><code>@JoinColumn</code> (within <code>@ManyToOne</code>): Specifies
the column in the “many” side entity that references the “one” side
entity.</li>
</ul></li>
<li>Many-to-Many Relationship:
<ul>
<li><code>@ManyToMany</code>: Defines a many-to-many relationship
between two entities.</li>
<li><code>@JoinTable</code>: Specifies the join table for the
many-to-many relationship, defining the columns and their mappings.</li>
</ul></li>
</ol>
<p>For detailed examples of relations (with annotation parameters) see:
<a href="https://www.baeldung.com/jpa-hibernate-associations"
class="uri">https://www.baeldung.com/jpa-hibernate-associations</a></p>
<h3 id="how-does-jpa-work">2.6 How does JPA work?</h3>
<figure>
<img src="./img/jpa-operation.png" alt="JPA operation" />
<figcaption aria-hidden="true">JPA operation</figcaption>
</figure>
<blockquote>
<p>❗: TODO</p>
</blockquote>
<hr />
<h2 id="node.js">3. Node.js</h2>
<p>Node.js is a JS runtime environment that runs on the V8 JavaScript
engine.</p>
<h3 id="example-http-server-in-node.js">3.1 Example HTTP-server in
Node.js</h3>
<div class="sourceCode" id="cb17"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> http <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;http&#39;</span>)<span class="op">;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> fs <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;fs&#39;</span>)<span class="op">;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> port <span class="op">=</span> <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">port</span> <span class="op">||</span> <span class="dv">8080</span><span class="op">;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>http<span class="op">.</span><span class="fu">createServer</span>( (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Request on port 8080&quot;</span>)<span class="op">;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="fu">writeHead</span>(<span class="dv">200</span><span class="op">,</span> {</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Content-Type&#39;</span><span class="op">:</span> <span class="st">&#39;text/html&#39;</span><span class="op">,</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Access-Control-Allow-Origin&#39;</span><span class="op">:</span> <span class="st">&#39;*&#39;</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> read <span class="op">=</span> fs<span class="op">.</span><span class="fu">createReadStream</span>(<span class="bu">__dirname</span> <span class="op">+</span> <span class="st">&#39;/index.html&#39;</span>)<span class="op">;</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  read<span class="op">.</span><span class="fu">pipe</span>(res)<span class="op">;</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>})<span class="op">.</span><span class="fu">listen</span>(port)<span class="op">;</span></span></code></pre></div>
<h3 id="routing">3.2 Routing</h3>
<figure>
<img src="./img/routing-nodejs.png" alt="Routing in Node.js" />
<figcaption aria-hidden="true">Routing in Node.js</figcaption>
</figure>
<p>server.js</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> server <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;./start&#39;</span>)<span class="op">;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> router <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;./router&#39;</span>)<span class="op">;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> requestHandlers <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;./handlers&quot;</span>)<span class="op">;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> handler <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>handler[<span class="st">&quot;/&quot;</span>] <span class="op">=</span> requestHandlers<span class="op">.</span><span class="at">home</span><span class="op">;</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>handler[<span class="st">&quot;/show&quot;</span>] <span class="op">=</span> requestHandlers<span class="op">.</span><span class="at">show</span><span class="op">;</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>handler[<span class="st">&quot;/upload&quot;</span>] <span class="op">=</span> requestHandlers<span class="op">.</span><span class="at">upload</span><span class="op">;</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>server<span class="op">.</span><span class="fu">start</span>(router<span class="op">.</span><span class="at">route</span><span class="op">,</span> handler)<span class="op">;</span></span></code></pre></div>
<p>handlers.js</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> fs <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;fs&#39;</span>)<span class="op">;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">home</span>(res) {</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">respond</span>(res<span class="op">,</span><span class="st">&#39;views/home.html&#39;</span>)<span class="op">;</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">show</span>(response) {<span class="op">...</span>}</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">upload</span>(response) {<span class="op">...</span>}</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">respond</span>(response<span class="op">,</span> file) {</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  fs<span class="op">.</span><span class="fu">readFile</span>(file<span class="op">,</span> (err<span class="op">,</span> data) <span class="kw">=&gt;</span> {</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    response<span class="op">.</span><span class="fu">writeHead</span>(<span class="dv">200</span><span class="op">,</span> {<span class="st">&quot;Content-Type&quot;</span><span class="op">:</span> <span class="st">&quot;text/html&quot;</span>})<span class="op">;</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    response<span class="op">.</span><span class="fu">write</span>(data)<span class="op">;</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    response<span class="op">.</span><span class="fu">end</span>()<span class="op">;</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>exports<span class="op">.</span><span class="at">home</span> <span class="op">=</span> home<span class="op">;</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>exports<span class="op">.</span><span class="at">show</span> <span class="op">=</span> show<span class="op">;</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>exports<span class="op">.</span><span class="at">upload</span> <span class="op">=</span> upload<span class="op">;</span></span></code></pre></div>
<p>router.js</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">route</span>(pathname<span class="op">,</span> handler<span class="op">,</span> response) {</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Request for &quot;</span> <span class="op">+</span> pathname)<span class="op">;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (handler[pathname] <span class="op">!==</span> <span class="kw">undefined</span>) {</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> handler[pathname](response)<span class="op">;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;No Method found for &quot;</span> <span class="op">+</span> pathname)<span class="op">;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>exports<span class="op">.</span><span class="at">route</span> <span class="op">=</span> route<span class="op">;</span></span></code></pre></div>
<p>start.js</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> http <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;http&quot;</span>)<span class="op">;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> url <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;url&quot;</span>)<span class="op">;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">start</span>(route<span class="op">,</span> handler) {</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Starting.&quot;</span>)<span class="op">;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  start<span class="op">.</span><span class="at">js</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">onRequest</span>(request<span class="op">,</span> response) {</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> pathname <span class="op">=</span> url<span class="op">.</span><span class="fu">parse</span>(request<span class="op">.</span><span class="at">url</span>)<span class="op">.</span><span class="at">pathname</span><span class="op">;</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> content <span class="op">=</span> <span class="fu">route</span>(pathname<span class="op">,</span> handler<span class="op">,</span> response)<span class="op">;</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>content) {</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>      response<span class="op">.</span><span class="fu">writeHead</span>(<span class="dv">404</span><span class="op">,</span> {<span class="st">&quot;Content-Type&quot;</span><span class="op">:</span> <span class="st">&quot;text/plain&quot;</span>})<span class="op">;</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>      response<span class="op">.</span><span class="fu">write</span>(<span class="st">&quot;404 Not found&quot;</span>)<span class="op">;</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>      response<span class="op">.</span><span class="fu">end</span>()<span class="op">;</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> port <span class="op">=</span> <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">port</span> <span class="op">||</span> <span class="dv">8080</span><span class="op">;</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  http<span class="op">.</span><span class="fu">createServer</span>(onRequest)<span class="op">.</span><span class="fu">listen</span>(port)<span class="op">;</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Has been started.&quot;</span>)<span class="op">;</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>exports<span class="op">.</span><span class="at">start</span> <span class="op">=</span> start<span class="op">;</span></span></code></pre></div>
<h3 id="the-node.js-system">3.3 The Node.js system</h3>
<figure>
<img src="./img/nodejs-system.jpg" alt="The Node.js system" />
<figcaption aria-hidden="true">The Node.js system</figcaption>
</figure>
<ul>
<li><strong>Engine</strong>: executes the code</li>
<li><strong>Event Loop</strong>: Everything that happens in Node is a
reaction to an event. Only one thread executes code, the thread where
the event loop is running.
<ol type="1">
<li><strong>Timers</strong>: Executes callbacks scheduled by
<code>setTimeout()</code> or <code>setInterval()</code></li>
<li><strong>I/O Callbacks</strong>: Handle I/O-related callbacks</li>
<li><strong>Poll</strong>: Retrieve new I/O events</li>
<li><strong>Check</strong>: Execute <code>setImmediate()</code>
callbacks</li>
<li><strong>Close Callbacks</strong>: Executes close event callbacks
(<code>socket.on('close',...)</code>)</li>
</ol></li>
</ul>
<blockquote>
<p>⚠️: Because of Node.js concurrency model, it’s important to never
block the event loop, instead, use callbacks and asynchronous
methods.</p>
</blockquote>
<h3 id="express.js">3.4 Express.js</h3>
<p>Express is a framework for Node.js that makes it easier to build
RESTful APIs. A significant part of Express revolves around
<strong>middleware</strong>.</p>
<dl>
<dt><strong>Middleware</strong></dt>
<dd>
software component that sits between a client and a server, intercepting
and processing HTTP requests and responses. It’s a common pattern in web
development used to perform various tasks like authentication, logging,
request parsing, error handling, and more.
</dd>
</dl>
<figure>
<img src="./img/express-framework.png"
alt="Structure of Express application" />
<figcaption aria-hidden="true">Structure of Express
application</figcaption>
</figure>
<h4 id="demo">Demo</h4>
<p>app.js</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> express <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;express&#39;</span>) <span class="co">// Module</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> path <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;path&#39;</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> logger <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;morgan&#39;</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> bodyParser <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;body-parser&#39;</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> routes <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;./routes/index&#39;</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> users <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;./routes/users&#39;</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> app <span class="op">=</span> <span class="fu">express</span>()</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">//Views</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;views&#39;</span><span class="op">,</span> path<span class="op">.</span><span class="fu">join</span>(<span class="bu">__dirname</span><span class="op">,</span> <span class="st">&#39;views&#39;</span>))</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;view engine&#39;</span><span class="op">,</span> <span class="st">&#39;pug&#39;</span>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Middleware</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="fu">logger</span>(<span class="st">&#39;dev&#39;</span>))</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(bodyParser<span class="op">.</span><span class="fu">json</span>())</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(bodyParser<span class="op">.</span><span class="fu">urlencoded</span>({ <span class="dt">extended</span><span class="op">:</span> <span class="kw">false</span> }))</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co">// Routes</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="st">&#39;/&#39;</span><span class="op">,</span> routes)<span class="op">;</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="st">&#39;/users&#39;</span><span class="op">,</span> users)<span class="op">;</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="co">// error handler</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>( (err<span class="op">,</span> req<span class="op">,</span> res<span class="op">,</span> next) <span class="kw">=&gt;</span> {</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="at">locals</span><span class="op">.</span><span class="at">message</span> <span class="op">=</span> err<span class="op">.</span><span class="at">message</span><span class="op">;</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="at">locals</span><span class="op">.</span><span class="at">error</span> <span class="op">=</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>  req<span class="op">.</span><span class="at">app</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;env&#39;</span>) <span class="op">===</span> <span class="st">&#39;development&#39;</span> <span class="op">?</span> err <span class="op">:</span> {}<span class="op">;</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="fu">status</span>(err<span class="op">.</span><span class="at">status</span> <span class="op">||</span> <span class="dv">500</span>)<span class="op">;</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="fu">render</span>(<span class="st">&#39;error&#39;</span>)<span class="op">;</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>module<span class="op">.</span><span class="at">exports</span> <span class="op">=</span> app<span class="op">;</span></span></code></pre></div>
<p>routes/index.js</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>let express <span class="op">=</span> <span class="fu">require</span><span class="op">(</span><span class="er">&#39;</span>express<span class="er">&#39;</span><span class="op">);</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>let router <span class="op">=</span> express<span class="op">.</span><span class="fu">Router</span><span class="op">();</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>router<span class="op">.</span><span class="fu">get</span><span class="op">(</span><span class="ch">&#39;/&#39;</span><span class="op">,</span> <span class="op">(</span>req<span class="op">,</span> res<span class="op">,</span> next<span class="op">)</span> <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="fu">render</span><span class="op">(</span><span class="er">&#39;</span>index<span class="er">&#39;</span><span class="op">,</span> <span class="op">{</span> title<span class="op">:</span> <span class="er">&#39;</span>Express<span class="er">&#39;</span> <span class="op">});</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>module<span class="op">.</span><span class="fu">exports</span> <span class="op">=</span> router<span class="op">;</span></span></code></pre></div>
<hr />
<h2 id="websockets">4. Websockets</h2>
<dl>
<dt><strong>Websocket</strong></dt>
<dd>
Websockets is a communication protocol that provides full-duplex,
persistent, communication channels over a single, long-lived TCP
connection. It’s designed to enable real-time communication between a
client, typically a web browser, and a server.
</dd>
</dl>
<p>WS client example:</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> ws <span class="op">=</span> <span class="kw">new</span> <span class="bu">WebSocket</span>(<span class="st">&quot;ws://www.websockets.org&quot;</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Open connection</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>ws<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;open&#39;</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> { ws<span class="op">.</span><span class="fu">send</span>(<span class="st">&quot;Hello server!&quot;</span>) })</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Listen for incoming messages</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>ws<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;message&#39;</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> { <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="bu">event</span><span class="op">.</span><span class="at">data</span>) })</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Send a message</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>ws<span class="op">.</span><span class="fu">send</span>(<span class="st">&quot;Hello&quot;</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Server closes connection</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>ws<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;close&#39;</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> { <span class="fu">alert</span>(<span class="st">&quot;closed&quot;</span>) })</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Client closes connection</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>ws<span class="op">.</span><span class="fu">close</span>()</span></code></pre></div>
<p>Before websockets, clients used <code>polling</code> to achieve the
same functionality. Websockets, however, have less latency and less
overhead which makes the way more efficient.</p>
<figure>
<img src="./img/ws-vs-polling.png" alt="Websocket vs Polling" />
<figcaption aria-hidden="true">Websocket vs Polling</figcaption>
</figure>
<hr />
<h2 id="reactive-rest-webservices">5. Reactive REST webservices</h2>
<dl>
<dt><strong>Reactive programming</strong></dt>
<dd>
programming paradigm focused on building asynchronous and event-driven
applications. At its core, reactive programming revolves around the idea
of handling data flows and sequences of events with a focus on reacting
to changes.
</dd>
</dl>
<h3 id="data-streams">5.1 Data streams</h3>
<p>Streams allow for requested data to be send as it comes. Parts of the
data can already be send while other parts have not been loaded into
memory yet. This is done by creating a <strong>pipeline</strong> that
subscribes to any incoming data, processes the data, and then publishes
it.</p>
<p>Traditional methods required the application to store requests in
memory. If the size of the required data is larger than the available
memory, an “out of memory” error will occur.</p>
<figure>
<img src="./img/reactive-data-streams.png"
alt="Traditional vs stream" />
<figcaption aria-hidden="true">Traditional vs stream</figcaption>
</figure>
<h3 id="observer-and-observables">5.2 Observer and observables</h3>
<p>Central to reactive programming are observables (or streams) that
emit/push values or events and observers (or subscribers) that react to
these emissions. Observers can subscribe to observables to receive and
handle emitted values asynchronously.</p>
<dl>
<dt><strong>Backpressure</strong></dt>
<dd>
When a data provider pushes more data to a client than it can handle.
This problem is solved by making the client pull available data, so it
can decide on how fast it receives data.
</dd>
</dl>
<figure>
<img src="./img/backpressure-solution.png"
alt="Solution to backpressure" />
<figcaption aria-hidden="true">Solution to backpressure</figcaption>
</figure>
<h3 id="reactor-java">5.3 Reactor Java</h3>
<figure>
<img src="./img/reactive-stream-java.png"
alt="Reactive streams in Java" />
<figcaption aria-hidden="true">Reactive streams in Java</figcaption>
</figure>
<p>To efficiently program reactive applications, the <a
href="https://projectreactor.io/">reactor</a> library is often used.</p>
<h4 id="reactor---flux">Reactor - Flux</h4>
<p>A <code>Flux</code> is used to emit multiple values (asynchronously)
over time.</p>
<h4 id="reactor---mono">Reactor - Mono</h4>
<p>A <code>Mono</code> is a kind of flux that can send only one element
or none at all.</p>
<h4 id="reactive-stack-vs-servlet-stack">Reactive stack vs Servlet
stack</h4>
<table>
<colgroup>
<col style="width: 51%" />
<col style="width: 48%" />
</colgroup>
<thead>
<tr class="header">
<th>Reactive Stack</th>
<th>Servlet Stack</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Spring security reactive</td>
<td>Spring Security</td>
</tr>
<tr class="even">
<td>Spring WebFlux</td>
<td>Spring MVC</td>
</tr>
<tr class="odd">
<td>Spring reactive repos: Mongo, Redis, …</td>
<td>Spring data repos: JDBC, JPA, NoSQL</td>
</tr>
</tbody>
</table>
<h4 id="example">Example</h4>
<p>Reactive DAO</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Service</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> SampleDAO<span class="op">{</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">final</span> <span class="bu">Random</span> random <span class="op">=</span> <span class="kw">new</span> <span class="bu">Random</span><span class="op">();</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span><span class="op">[]</span> ids <span class="op">=</span> <span class="op">{</span><span class="st">&quot;S1&quot;</span><span class="op">,</span> <span class="st">&quot;S2&quot;</span><span class="op">,</span> <span class="st">&quot;S3&quot;</span><span class="op">};</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> Flux<span class="op">&lt;</span>Sample<span class="op">&gt;</span> <span class="fu">getSamples</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Flux<span class="op">.</span><span class="fu">interval</span><span class="op">(</span><span class="bu">Duration</span><span class="op">.</span><span class="fu">ofSeconds</span><span class="op">(</span><span class="dv">1</span><span class="op">)).</span><span class="fu">take</span><span class="op">(</span><span class="dv">10</span><span class="op">)</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">map</span><span class="op">(</span>pulse <span class="op">-&gt;</span> <span class="fu">getSample</span><span class="op">());</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> Sample <span class="fu">getSample</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    Sample s <span class="op">=</span> <span class="kw">new</span> <span class="fu">Sample</span><span class="op">();</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    s<span class="op">.</span><span class="fu">setId</span><span class="op">(</span>ids<span class="op">[</span>random<span class="op">.</span><span class="fu">nextInt</span><span class="op">(</span>ids<span class="op">.</span><span class="fu">length</span><span class="op">)]);</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    s<span class="op">.</span><span class="fu">setTime</span><span class="op">(</span>LocalDateTime<span class="op">.</span><span class="fu">now</span><span class="op">());</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    s<span class="op">.</span><span class="fu">setValue</span><span class="op">(</span><span class="fl">4882.42</span><span class="op">);</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> s<span class="op">;</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Reactive controller</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="at">@RestController</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="at">@RequestMapping</span><span class="op">(</span><span class="st">&quot;samples&quot;</span><span class="op">)</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> SampleController <span class="op">{</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> SampleDAO dao<span class="op">;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">SampleController</span><span class="op">(</span>SampleDAO dao<span class="op">)</span> <span class="op">{</span> <span class="kw">this</span><span class="op">.</span><span class="fu">dao</span> <span class="op">=</span> dao<span class="op">;</span> <span class="op">}</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">@GetMapping</span><span class="op">(</span><span class="st">&quot;sample&quot;</span><span class="op">)</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> Flux<span class="op">&lt;</span>Sample<span class="op">&gt;</span> <span class="fu">getSamples</span><span class="op">()</span> <span class="op">{</span> <span class="cf">return</span> dao<span class="op">.</span><span class="fu">getSamples</span><span class="op">();</span> <span class="op">}</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Reactive client</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> ClientTestWebflux <span class="op">{</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="dt">void</span> <span class="fu">testServer</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    WebClient client <span class="op">=</span> WebClient<span class="op">.</span><span class="fu">create</span><span class="op">(</span><span class="st">&quot;http://localhost:8080&quot;</span><span class="op">);</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    Flux<span class="op">&lt;</span>Sample<span class="op">&gt;</span> sampleFlux <span class="op">=</span> client<span class="op">.</span><span class="fu">get</span><span class="op">()</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">uri</span><span class="op">(</span><span class="st">&quot;/samples&quot;</span><span class="op">)</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">retrieve</span><span class="op">()</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">bodyToFlux</span><span class="op">(</span>Sample<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    sampleFlux<span class="op">.</span><span class="fu">subscribe</span><span class="op">(</span><span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">::</span>println<span class="op">);</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">&quot;in test webflux&quot;</span><span class="op">);</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<hr />
<h2 id="jdbc">6. JDBC</h2>
<dl>
<dt><strong>JDBC (Java Database Connectivity API)</strong></dt>
<dd>
An API that allows Java applications to interact with databases.
</dd>
</dl>
<ul>
<li>Accesses SQL-compatible relational databases from Java
application</li>
<li>Can perform SQL-queries and process data</li>
<li>Abstraction for common database functions</li>
<li>Same application should work on different databases (no need to
rewrite backend)</li>
</ul>
<h3 id="jdbc-drivers">6.1 JDBC drivers</h3>
<figure>
<img src="./img/JDBC-drivers.png" alt="JDBC driver types" />
<figcaption aria-hidden="true">JDBC driver types</figcaption>
</figure>
<h3 id="jdbc-example">6.2 JDBC Example</h3>
<h4 id="configuration">Configuration</h4>
<p>db_constants.properties</p>
<pre class="text"><code># info databank
username=TLuca
password=&lt;redacted&gt;
driver=org.postgresql.Driver
connectionstring=jdbc:postgresql://localhost:5432/db_name

#Constanten for table products
Q_select_products=select * from products
Q_select_product=select * from products where productCode = ?

# Mappings to column names
prod_code=productCode
prod_name=productName
prod_price=buyPrice
prod_msrp=MSRP</code></pre>
<h4 id="making-connection">Making connection</h4>
<div class="sourceCode" id="cb29"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Component</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="at">@PropertySource</span><span class="op">(</span><span class="st">&quot;classpath:databankconstanten.properties&quot;</span><span class="op">)</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> JDBCDataStorage <span class="kw">implements</span> IDataStorage <span class="op">{</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Value</span><span class="op">(</span><span class="st">&quot;${connectionstring}&quot;</span><span class="op">)</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">String</span> connString<span class="op">;</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Value</span><span class="op">(</span><span class="st">&quot;${username}&quot;</span><span class="op">)</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">String</span> login<span class="op">;</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Value</span><span class="op">(</span><span class="st">&quot;${password}&quot;</span><span class="op">)</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">String</span> password<span class="op">;</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Columns</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Value</span><span class="op">(</span><span class="st">&quot;${prod_code}&quot;</span><span class="op">)</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">String</span> prodCode<span class="op">;</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Value</span><span class="op">(</span><span class="st">&quot;${prod_name}&quot;</span><span class="op">)</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">String</span> prodName<span class="op">;</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Value</span><span class="op">(</span><span class="st">&quot;${prod_price}&quot;</span><span class="op">)</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">String</span> prodPrice<span class="op">;</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Value</span><span class="op">(</span><span class="st">&quot;${prod_msrp}&quot;</span><span class="op">)</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">String</span> prodMsrp<span class="op">;</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">// SQL-queries</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Value</span><span class="op">(</span><span class="st">&quot;${Q_select_products}&quot;</span><span class="op">)</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">String</span> selectProducts<span class="op">;</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">DataSource</span> dataSource<span class="op">;</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Autowired</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setDataSource</span><span class="op">(</span><span class="bu">DataSource</span> dataSource<span class="op">)</span> <span class="op">{</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">dataSource</span> <span class="op">=</span> dataSource<span class="op">;</span></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">Connection</span> <span class="fu">openConnectie</span><span class="op">()</span> <span class="kw">throws</span> <span class="bu">SQLException</span> <span class="op">{</span></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> dataSource<span class="op">.</span><span class="fu">getConnection</span><span class="op">();</span></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="performing-actions-get-on-database">Performing actions (GET) on
database</h4>
<div class="sourceCode" id="cb30"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="bu">List</span><span class="op">&lt;</span>IProduct<span class="op">&gt;</span> <span class="fu">getProducts</span><span class="op">()</span> <span class="kw">throws</span> DataException <span class="op">{</span> <span class="co">// DataException is custom class</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">List</span><span class="op">&lt;</span>IProduct<span class="op">&gt;</span> products<span class="op">;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> <span class="op">(</span><span class="bu">Connection</span> conn <span class="op">=</span> <span class="fu">openConnectie</span><span class="op">();</span> <span class="bu">Statement</span> stmt <span class="op">=</span> conn<span class="op">.</span><span class="fu">createStatement</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span>conn<span class="op">.</span><span class="fu">getClass</span><span class="op">());</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span>stmt<span class="op">.</span><span class="fu">getClass</span><span class="op">());</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">ResultSet</span> rs <span class="op">=</span> stmt<span class="op">.</span><span class="fu">executeQuery</span><span class="op">(</span>selectProducts<span class="op">);</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span>rs<span class="op">.</span><span class="fu">getClass</span><span class="op">());</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    products <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>rs<span class="op">.</span><span class="fu">next</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>      products<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="fu">createProduct</span><span class="op">(</span>rs<span class="op">));</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="bu">SQLException</span> ex<span class="op">)</span> <span class="op">{</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">DataExceptie</span><span class="op">(</span>foutProducts<span class="op">);</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> products<span class="op">;</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="sql-injection">6.3 SQL-injection</h3>
<p>When using prepared statements, we possibly expose the application to
SQL-injection. We can defend ourself against this vulnerability by
working with parameters:</p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> username <span class="op">=</span> <span class="fu">getUserInput</span><span class="op">();</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> sql <span class="op">=</span> <span class="st">&quot;SELECT * FROM users WHERE username = ?&quot;</span><span class="op">;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="bu">PreparedStatement</span> preparedStatement <span class="op">=</span> connection<span class="op">.</span><span class="fu">prepareStatement</span><span class="op">(</span>sql<span class="op">);</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>preparedStatement<span class="op">.</span><span class="fu">setString</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span> username<span class="op">);</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="bu">ResultSet</span> resultSet <span class="op">=</span> preparedStatement<span class="op">.</span><span class="fu">executeQuery</span><span class="op">();</span></span></code></pre></div>
<h3 id="driver-vs-datasource">6.4 Driver vs DataSource</h3>
<p><strong>DataSource</strong>:</p>
<ul>
<li>Spring</li>
<li>Represents a DBMS</li>
<li>Available through dependency injection or JNDI</li>
<li>Safer than driver: No configuration in code.</li>
</ul>
<h3 id="orm-vs-jdbc">6.5 ORM vs JDBC</h3>
<ul>
<li>JDBC/ADO.NET:
<ul>
<li>Time-intensive</li>
<li>Low-level data-access</li>
</ul></li>
<li>ORM
<ul>
<li>Defining a mapping with annotations</li>
<li>Less performant</li>
<li>Faster dev time</li>
</ul></li>
</ul>
<hr />
<h2 id="ado.net">7. ADO.NET</h2>
<p>To get access from .NET-application to datasource (database, xml,
…).</p>
<ul>
<li>Loose coupling between application and datasource: Perform data
manipulations on a part of the data without immediately applying these
changes to the datasource.</li>
<li>Easy to convert to XML</li>
</ul>
<h3 id="ado.net-architecture">7.1 ADO.NET Architecture</h3>
<figure>
<img src="./img/ado-architecture.png" alt="ADO.NET architecture" />
<figcaption aria-hidden="true">ADO.NET architecture</figcaption>
</figure>
<h3 id="dataset">7.2 DataSet</h3>
<p>A <code>DataSet</code> is a collection of data tables that contain
the data. It is used to fetch data without interacting with a Data
Source. It is an in-memory data store that can hold more than one table
at the same time.</p>
<h4 id="creating-a-dataset">Creating a DataSet</h4>
<div class="sourceCode" id="cb32"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Creating a DataSet</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>DataSet ds <span class="op">=</span> <span class="kw">new</span> <span class="fu">DataSet</span><span class="op">();</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>DataSet customerDS <span class="op">=</span> <span class="kw">new</span> <span class="fu">DataSet</span><span class="op">(</span><span class="st">&quot;CustomerOrders&quot;</span><span class="op">);</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Creating a Table</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>DataTable orders <span class="op">=</span> customerDS<span class="op">.</span><span class="fu">Tables</span><span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="st">&quot;Orders&quot;</span><span class="op">);</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Creating column</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>DataColumn orderId <span class="op">=</span> orders<span class="op">.</span><span class="fu">Comumns</span><span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="st">&quot;OrderID&quot;</span><span class="op">,</span> <span class="kw">typeof</span><span class="op">(</span>Int32<span class="op">));</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Key constraint</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>orders<span class="op">.</span><span class="fu">PrimaryKey</span> <span class="op">=</span> <span class="kw">new</span> DataColumn<span class="op">[]</span> <span class="op">{</span>orderId<span class="op">};</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="co">// Adding data to rows</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>DataRow rowOrders <span class="op">=</span> orders<span class="op">.</span><span class="fu">NewRow</span><span class="op">();</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>rowOrders<span class="op">[</span>bestelID<span class="op">]</span> <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>rowOrders<span class="op">[</span><span class="st">&quot;Quantity&quot;</span><span class="op">]</span> <span class="op">=</span> <span class="dv">9</span><span class="op">;</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>orders<span class="op">.</span><span class="fu">Rows</span><span class="op">.</span><span class="fu">Add</span><span class="op">(</span>rowOrders<span class="op">);</span></span></code></pre></div>
<h3 id="dataprovider">7.3 DataProvider</h3>
<figure>
<img src="./img/ado-DataProviders.png" alt="Data Provides" />
<figcaption aria-hidden="true">Data Provides</figcaption>
</figure>
<h4 id="key-objects">Key objects</h4>
<ul>
<li><code>Connection</code>: Connect to DB</li>
<li><code>Command</code>: Perform a command</li>
<li><code>DataReader</code>: Obtain data</li>
<li><code>DataAdapter</code>: Connect DataSet with DB</li>
</ul>
<h3 id="data-manipulation">7.4 Data Manipulation</h3>
<p>OrdersDAOReader.cs</p>
<div class="sourceCode" id="cb33"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Configuration</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>String task <span class="op">=</span> ConfigurtionManager<span class="op">.</span><span class="fu">AppSettings</span><span class="op">[</span><span class="st">&quot;SELECT_ORDER&quot;</span><span class="op">];</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>ConnectionStringSettings connStringSet <span class="op">=</span> ConfigurationManager<span class="op">.</span><span class="fu">ConnectionString</span><span class="op">[</span><span class="st">&quot;orders&quot;</span><span class="op">];</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Factory for provider</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>DbProviderFactory factory <span class="op">=</span> DbProviderFactory<span class="op">.</span><span class="fu">GetFactory</span><span class="op">(</span>connStringSet<span class="op">.</span><span class="fu">ProviderName</span><span class="op">);</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Connection object</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>DbConnection conn <span class="op">=</span> factory<span class="op">.</span><span class="fu">CreateConnection</span><span class="op">();</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>DbCommand command <span class="op">=</span> conn<span class="op">.</span><span class="fu">CreateCommand</span><span class="op">();</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>command<span class="op">.</span><span class="fu">CommandText</span> <span class="op">=</span> Configuration<span class="op">.</span><span class="fu">AppSettings</span><span class="op">[</span><span class="st">&quot;SELECT_ORDERS&quot;</span><span class="op">]</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co">// Run command-objects</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="op">(</span>DbConnection conn <span class="op">=</span> <span class="op">...)</span> <span class="op">{</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  conn<span class="op">.</span><span class="fu">Open</span><span class="op">()</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// delete-, insert-, update queries</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> rowsChanged <span class="op">=</span> command<span class="op">.</span><span class="fu">ExecuteNonQuery</span><span class="op">();</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">// select queries</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  DbDataReader reader <span class="op">=</span> command<span class="op">.</span><span class="fu">ExecuteReader</span><span class="op">();</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>  <span class="kw">while</span> <span class="op">(</span>reader<span class="op">.</span><span class="fu">Read</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    DataRow row <span class="op">=</span> tableOrder<span class="op">.</span><span class="fu">NewRow</span><span class="op">();</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    row<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> reader<span class="op">[</span><span class="st">&quot;orderID&quot;</span><span class="op">];</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    row<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> reader<span class="op">[</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>    row<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> reader<span class="op">.</span><span class="fu">GetString</span><span class="op">(</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>    tabelOrder<span class="op">.</span><span class="fu">Rows</span><span class="op">.</span><span class="fu">Add</span><span class="op">(</span>row<span class="op">);</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>App.config</p>
<div class="sourceCode" id="cb34"><pre
class="sourceCode xml"><code class="sourceCode xml"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">configuration</span>&gt;</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">connectionStrings</span>&gt;</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">add</span><span class="ot"> name=</span><span class="st">&quot;orders&quot;</span><span class="ot"> providerName=</span><span class="st">&quot;System.Data.SqlClient&quot;</span> </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="ot">      connectionString=</span><span class="st">&quot;Data Source=(LocalDB)\MSSQLLocalDB&quot;</span>/&gt;</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  &lt;/<span class="kw">connectionStrings</span>&gt;</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">appSettings</span>&gt;</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">add</span><span class="ot"> key=</span><span class="st">&quot;SELECT_ORDER&quot;</span><span class="ot"> value=</span><span class="st">&quot;select * from Orders&quot;</span>/&gt;</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  &lt;/<span class="kw">appSettings</span>&gt;</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">configuration</span>&gt; </span></code></pre></div>
<h3 id="dataadapter">7.5 DataAdapter</h3>
<p>The adapter can add data to the <code>DataTable</code>, and write
those changes to the DB. Before, the changes in <code>DataTable</code>
where not definitive.</p>
<p><code>DataAdapter</code> has 4 Command-objects:</p>
<ul>
<li><code>SelectCommand</code>: Retrieves data from the database based
on specified criteria, usually in the form of a SELECT query</li>
<li><code>InsertCommand</code>: Inserts new data into the database. It
typically includes an INSERT query</li>
<li><code>UpdateCommand</code>: Modifies existing data in the database.
(Write changes made to <code>DataSource</code> to DB)</li>
<li><code>DeleteCommand</code>: Removes data from the database</li>
</ul>
<p>OrderDAOAddapter.cs</p>
<div class="sourceCode" id="cb35"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>DbDataAdapter adapter <span class="op">=</span> factory<span class="op">.</span><span class="fu">CreateDataAdapter</span><span class="op">();</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>DbCommand command <span class="op">=</span> <span class="op">...;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>adapter<span class="op">.</span><span class="fu">SelectCommand</span> <span class="op">=</span> <span class="op">...;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>DataSet customerDS <span class="op">=</span> <span class="kw">new</span> <span class="fu">DataSet</span><span class="op">(</span>DS_ORDERS<span class="op">);</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>adapter<span class="op">.</span><span class="fu">Fill</span><span class="op">(</span>customerDS<span class="op">,</span> TABLE_ORDERS<span class="op">);</span></span></code></pre></div>
<h3 id="transactions">7.6 Transactions</h3>
<ol type="1">
<li>Start transaction</li>
<li>Assigning a Transaction-obj to a Commmand-obj</li>
<li>Running the queries</li>
<li>Commit - Rollback</li>
</ol>
<div class="sourceCode" id="cb36"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="op">(</span>DbConnection conn <span class="op">=</span> <span class="op">...)</span> <span class="op">{</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  conn<span class="op">.</span><span class="fu">Open</span><span class="op">();</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Basic transaction</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">using</span> <span class="op">(</span>DbTransaction trans <span class="op">=</span> conn<span class="op">.</span><span class="fu">BeginTransaction</span><span class="op">())</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">try</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Perform database operations within the transaction</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Commit the transaction</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>      trans<span class="op">.</span><span class="fu">Commit</span><span class="op">();</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="kw">catch</span> <span class="op">(</span>Exception<span class="op">)</span> <span class="op">{</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Rollback the transaction if an exception occurs</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>      trans<span class="op">.</span><span class="fu">Rollback</span><span class="op">();</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<hr />
<h2 id="rest-services-in-.net">8. REST-services in .NET</h2>
<h3 id="web-api">8.1 Web API</h3>
<p>The .NET alternative to the Spring framework for REST-services is
ASP.NET. It makes it possible to easily create a HTTP service that
exposes an application’s functionality and data as services over the
internet using standard HTTP methods (GET, POST, PUT, DELETE, etc.) and
data formats like JSON or XML.</p>
<figure>
<img src="./img/asp-mvc.png" alt="ASP.NET architecture" />
<figcaption aria-hidden="true">ASP.NET architecture</figcaption>
</figure>
<h4 id="example-1">Example</h4>
<p>Controllers/PrimateController.cs</p>
<div class="sourceCode" id="cb37"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Route</span><span class="op">(</span><span class="st">&quot;api/ape_species&quot;</span><span class="op">)]</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="op">[</span>ApiController<span class="op">]</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> PrimateController <span class="op">:</span> ControllerBase <span class="op">{</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="kw">readonly</span> PrimateContext _context<span class="op">;</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">PrimateController</span><span class="op">(</span>PrimateSpeciesContext ctx<span class="op">)</span> <span class="op">{</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    _context <span class="op">=</span> ctx<span class="op">;</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span><span class="op">(</span>_context<span class="op">.</span><span class="fu">PrimateSpecies</span><span class="op">.</span><span class="fu">Count</span><span class="op">()</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>      _context<span class="op">.</span><span class="fu">PrimateSpecies</span><span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> PrimateSpecies <span class="op">{</span> Name <span class="op">=</span> <span class="st">&quot;Black Spider Monkey&quot;</span><span class="op">});</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>      _context<span class="op">.</span><span class="fu">SaveChanges</span><span class="op">();</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  <span class="op">[</span>HttpGet<span class="op">]</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> IEnumerable<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;</span> <span class="fu">Get</span><span class="op">()</span> <span class="op">{...}</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>  <span class="op">[</span><span class="fu">HttpGet</span><span class="op">(</span><span class="st">&quot;{id}&quot;</span><span class="op">)]</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> async Task<span class="op">&lt;</span>ActionResult<span class="op">&lt;</span>PrimateSpecies<span class="op">&gt;</span> <span class="fu">GetSpeciesById</span><span class="op">(</span><span class="dt">long</span> id<span class="op">)</span> <span class="op">{</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> species <span class="op">=</span> await _context<span class="op">.</span><span class="fu">PrimateSpeciesCollection</span><span class="op">.</span><span class="fu">FindAsync</span><span class="op">(</span>id<span class="op">);</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>species <span class="op">==</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span> <span class="kw">return</span> <span class="fu">NotFound</span><span class="op">();</span> <span class="op">}</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> species<span class="op">;</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>  <span class="op">[</span>HttpPost<span class="op">]</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> async Task<span class="op">&lt;</span>ActionResult<span class="op">&lt;</span>PrimateSpecies<span class="op">&gt;&gt;</span> <span class="fu">PostPrimate</span><span class="op">(</span>PrimateSpecies species<span class="op">)</span> <span class="op">{</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>    _context<span class="op">.</span><span class="fu">PrimateSpeciesCollection</span><span class="op">.</span><span class="fu">Add</span><span class="op">(</span>species<span class="op">);</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>    await _context<span class="op">.</span><span class="fu">SaveChangesAsync</span><span class="op">();</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="fu">CreatedAtAction</span><span class="op">(</span><span class="st">&quot;GetSpeciesById&quot;</span><span class="op">,</span> <span class="kw">new</span> <span class="op">{</span> id <span class="op">=</span> species<span class="op">.</span><span class="fu">Id</span><span class="op">},</span> species<span class="op">);</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>  <span class="op">[</span><span class="fu">HttpDelete</span><span class="op">(</span><span class="st">&quot;{id}&quot;</span><span class="op">)]</span></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> async Task<span class="op">&lt;</span>ActionResult<span class="op">&lt;</span>PrimateSpecies<span class="op">&gt;&gt;</span> <span class="fu">DeletePrimateSpecies</span><span class="op">(</span><span class="dt">long</span> id<span class="op">)</span> <span class="op">{</span></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> species <span class="op">=</span> await _context<span class="op">.</span><span class="fu">PrimateSpeciesCollection</span><span class="op">.</span><span class="fu">FindAsync</span><span class="op">(</span>id<span class="op">);</span></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>species <span class="op">==</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span> <span class="kw">return</span> <span class="fu">NotFound</span><span class="op">();</span> <span class="op">}</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>    _context<span class="op">.</span><span class="fu">SapienSpeciesCollection</span><span class="op">.</span><span class="fu">Remove</span><span class="op">(</span>species<span class="op">);</span></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>    await _context<span class="op">.</span><span class="fu">SaveChangesAsync</span><span class="op">();</span></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> species<span class="op">;</span></span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Modes/DbContext.cs</p>
<div class="sourceCode" id="cb38"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> PrimateSpeciesContext<span class="op">:</span> DbContext <span class="op">{</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">PrimateSpeciesContext</span><span class="op">(</span>DbContextOptions<span class="op">&lt;</span>PrimateSpeciesContext<span class="op">&gt;</span> options<span class="op">)</span> <span class="op">:</span> <span class="kw">base</span><span class="op">(</span>options<span class="op">)</span> <span class="op">{</span> <span class="op">}</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> DbSet<span class="op">&lt;</span>PrimateSpecies<span class="op">&gt;</span> SapienSpeciesCollection <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Models/PrimateSpecies.cs</p>
<div class="sourceCode" id="cb39"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>nanespace vbWebAPI<span class="op">.</span><span class="fu">Models</span> <span class="op">{</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="kw">class</span> PrimateSpecies <span class="op">{</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">long</span> Id <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span>Required<span class="op">]</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> Name <span class="op">{</span><span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">DefaultValue</span><span class="op">(</span><span class="kw">false</span><span class="op">)]</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">bool</span> IsComplete <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="openapi-specification">8.2 OpenAPI specification</h3>
<ul>
<li>Format to describe a REST-webservice
<ul>
<li>Info: licence, contact, …</li>
<li>Servers: Which URL’s are available</li>
<li>Security: Which security mechanisms are implemented</li>
<li>Pahts: The different endpoints (+ Methods)</li>
<li>Tags: to group paths</li>
<li>ExternlDocs: reference to docs</li>
</ul></li>
<li>In JSON or YAML</li>
</ul>
<figure>
<img src="./img/OpenAPI.png" alt="OpenAPI 3.0" />
<figcaption aria-hidden="true">OpenAPI 3.0</figcaption>
</figure>
<h4 id="swagger">Swagger</h4>
<p>JSON is easy to automatically generate JSON using <a
href="https://swagger.io/">swagger.io</a>.</p>
<blockquote>
<p>💡: Swagger can also interpret comments in code like
<code>javadocs</code></p>
</blockquote>
<hr />
<h2 id="asp.net-core-mvc">9. ASP.NET Core MVC</h2>
<h3 id="model-view-controller-pattern-mvc">Model-View-Controller-pattern
(MVC)</h3>
<figure>
<img src="./img/ASP-MVC2.png" alt="ASP.NET MVC" />
<figcaption aria-hidden="true">ASP.NET MVC</figcaption>
</figure>
<p>MVC’s aim to separate concerns within an application by dividing it
into three interconnected components:</p>
<ol type="1">
<li><strong>Model</strong>: data and business logic</li>
<li><strong>View</strong>: Presentation layer (UI)</li>
<li><strong>Controller</strong>: intermediary between the Model and the
View. It handles user input and translates it into actions performed by
the Model or View</li>
</ol>
<figure>
<img src="./img/mvc-pattern.png" alt="MVC pattern" />
<figcaption aria-hidden="true">MVC pattern</figcaption>
</figure>
<p>Structure:</p>
<pre class="text"><code>Application
  ┣━ /Controllers/
  ┃   ┗ ProductController.cs
  ┣━ /Models/
  ┃   ┗ ProductModel.cs
  ┣━ /Views/
  ┃   ┗ /Product/
  ┃       ┣ Index.cshtml
  ┃       ┗ Details.cshtml
  ┗━ Program.cs</code></pre>
<h4 id="model">Model</h4>
<div class="sourceCode" id="cb41"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Product model class representing the data structure</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> Product</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> Id <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">Display</span><span class="op">(</span>Name <span class="op">=</span> <span class="st">&quot;Name&quot;</span><span class="op">)]</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">Required</span><span class="op">(</span>ErrorMessage <span class="op">=</span> <span class="st">&quot;Name can not be empty.&quot;</span><span class="op">)]</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> Name <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">decimal</span> Price <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="view">View</h4>
<ul>
<li><code>View()</code>: Opens view with name matching the method</li>
<li><code>View("String")</code>: Opens view
<code>string.cshtml</code></li>
<li><code>View(Object)</code>: proved Object to view called
<code>&lt;methodname&gt;.cshtml</code></li>
<li><code>View("string", Object)</code>: provide Object to view called
<code>string.cshtml</code></li>
</ul>
<div class="sourceCode" id="cb42"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>@model List<span class="op">&lt;</span>Product<span class="op">&gt;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>ul<span class="op">&gt;</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    @<span class="fu">foreach</span> <span class="op">(</span><span class="dt">var</span> product <span class="kw">in</span> Model<span class="op">)</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>li<span class="op">&gt;</span>@product<span class="op">.</span><span class="fu">Name</span> <span class="op">-</span> $@product<span class="op">.</span><span class="fu">Price</span><span class="op">&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;/</span>ul<span class="op">&gt;</span></span></code></pre></div>
<h4 id="controller">Controller</h4>
<ol type="1">
<li>Provides Views</li>
<li>Handle errors during action</li>
<li><code>IActionResult</code> return the View that matches the method
name, but can also:
<ul>
<li>Render a partial view (view within another view)</li>
<li>Redirect to other method</li>
<li>Return JavaScript to execute</li>
<li>…</li>
</ul></li>
<li>Can also pass data to View</li>
<li>Can handle request from client (using HTTP-methods +
parameters)</li>
</ol>
<div class="sourceCode" id="cb43"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> ProductController <span class="op">:</span> Controller</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> IActionResult <span class="fu">Index</span><span class="op">()</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Simulated data retrieval</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> products <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>Product<span class="op">&gt;</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>            <span class="kw">new</span> Product <span class="op">{</span> Id <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> Name <span class="op">=</span> <span class="st">&quot;Product A&quot;</span><span class="op">,</span> Price <span class="op">=</span> <span class="fl">19.99M</span> <span class="op">},</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>            <span class="kw">new</span> Product <span class="op">{</span> Id <span class="op">=</span> <span class="dv">2</span><span class="op">,</span> Name <span class="op">=</span> <span class="st">&quot;Product B&quot;</span><span class="op">,</span> Price <span class="op">=</span> <span class="fl">29.99M</span> <span class="op">},</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>            <span class="kw">new</span> Product <span class="op">{</span> Id <span class="op">=</span> <span class="dv">3</span><span class="op">,</span> Name <span class="op">=</span> <span class="st">&quot;Product C&quot;</span><span class="op">,</span> Price <span class="op">=</span> <span class="fl">39.99M</span> <span class="op">}</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="fu">View</span><span class="op">(</span>products<span class="op">);</span> <span class="co">// Pass the list of products to the view</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// /Product/Detail/{id}</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> IActionResult <span class="fu">Details</span><span class="op">(</span><span class="dt">int</span> id<span class="op">)</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="fu">View</span><span class="op">(</span>id<span class="op">);</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">// /Product/Details?id={id}</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> IActionResult <span class="fu">Details</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="fu">View</span><span class="op">(</span>Convert<span class="op">.</span><span class="fu">ToInt32</span><span class="op">(</span>Request<span class="op">[</span><span class="st">&quot;id&quot;</span><span class="op">]));</span></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="routing-1">Routing</h4>
<p>Program.cs:</p>
<div class="sourceCode" id="cb44"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">MapControllerRoute</span><span class="op">(</span>name<span class="op">:</span> <span class="st">&quot;blog&quot;</span><span class="op">,</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  pattern<span class="op">:</span> <span class="st">&quot;blog/{*article}&quot;</span><span class="op">,</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  defaults<span class="op">:</span> <span class="kw">new</span> <span class="op">{</span> controller <span class="op">=</span> <span class="st">&quot;Blog&quot;</span><span class="op">,</span> action <span class="op">=</span> <span class="st">&quot;Article&quot;</span> <span class="op">});</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">MapControllerRoute</span><span class="op">(</span>name<span class="op">:</span> <span class="st">&quot;default&quot;</span><span class="op">,</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  pattern<span class="op">:</span> <span class="st">&quot;{controller=Home}/{action=Index}/{id?}&quot;</span><span class="op">);</span></span></code></pre></div>
<blockquote>
<p>⚠️: It’s also important that the app is protected against XSRF/CSRF
(Cross-site request forgery): attacker exploits a user’s authenticated
session to execute malicious actions. To prevent this, tokens or
verification techniques are used to confirm the authenticity of
requests, ensuring they originate from the expected user.</p>
</blockquote>
<figure>
<img src="./img/XSRF.png" alt="XSRF" />
<figcaption aria-hidden="true">XSRF</figcaption>
</figure>
<h3 id="globalization-and-localization">Globalization and
Localization</h3>
<dl>
<dt><strong>Globalization</strong></dt>
<dd>
Application should support multiple languages and cultures (eg: display
Arabic characters)
</dd>
<dt><strong>Localization</strong></dt>
<dd>
Change application to a specific language or culture
</dd>
</dl>
<ol type="1">
<li>Make content changeable</li>
<li>Provide content per language / culture (XML files with different
language, decision on which language to use can be done with
middleware)</li>
<li>Select language / culture</li>
</ol>
<h3 id="security">Security</h3>
<h4 id="authentication-1">Authentication</h4>
<div class="sourceCode" id="cb45"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Only add storage if user had valid identity</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">Services</span><span class="op">.</span><span class="fu">AddDefaultIdentity</span><span class="op">&lt;</span>IdentityUser<span class="op">&gt;(</span>options <span class="op">=&gt;</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  options<span class="op">.</span><span class="fu">SignIn</span><span class="op">.</span><span class="fu">RequireConfirmedAccount</span> <span class="op">=</span> <span class="kw">true</span><span class="op">)</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">AddEntityFrameworkStores</span><span class="op">&lt;</span>ApplicationDbContext<span class="op">&gt;();</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">UseAuthentication</span><span class="op">();</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">UseAuthorization</span><span class="op">();</span></span></code></pre></div>
<h4 id="authorization-1">Authorization</h4>
<div class="sourceCode" id="cb46"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> AccountController <span class="op">:</span> Controller <span class="op">{</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">[</span>AllowAnonymous<span class="op">]</span> <span class="co">// Allow anyone</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> ActionResult <span class="fu">Login</span><span class="op">(){</span> <span class="op">}</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">[</span>Authorize<span class="op">]</span> <span class="co">// Allow only to authorized users</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> ActionResult <span class="fu">Logout</span><span class="op">(){</span> <span class="op">}</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">[</span><span class="fu">Authorize</span><span class="op">(</span>Roles <span class="op">=</span> <span class="st">&quot;Administrator&quot;</span><span class="op">)]</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> ActionResult <span class="fu">AdminPanel</span><span class="op">()</span> <span class="op">{}</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<hr />
<h2 id="security-1">10. Security</h2>
<h3 id="authentication-2">10.1 Authentication</h3>
<ul>
<li>“Recognizing” users</li>
<li>Provide login for users</li>
</ul>
<h4 id="cookie-based-auth---sessions">Cookie-based auth -&gt;
Sessions</h4>
<ol type="1">
<li>Client logs in</li>
<li>Browser sends login details to server</li>
<li>Server adds cookie with session-id in header</li>
<li>Client includes cookie in header with every request it makes</li>
<li>Sever saves info about client (session-object)</li>
</ol>
<figure>
<img src="./img/auth-cookie.png" alt="Cookies: session auth" />
<figcaption aria-hidden="true">Cookies: session auth</figcaption>
</figure>
<ul>
<li>✅: Login only once</li>
<li>✅: Validity of cookie can get disabled</li>
<li>❌: Only valid for one domain</li>
<li>❌: Vulnerable for XSS- and XSRF attacks</li>
<li>❌: Not <em>stateless</em>: temporary save user info on server</li>
</ul>
<h4 id="token-based-auth">Token-based auth</h4>
<ol type="1">
<li>Client logs in</li>
<li>Browser sends login details to server</li>
<li>Server makes token</li>
<li>Token gets saved in browser memory</li>
<li>Client provides token in every request in Auth-header</li>
<li>Server decodes token and verifies credentials</li>
</ol>
<figure>
<img src="./img/auth-token.png" alt="Token-based Auth" />
<figcaption aria-hidden="true">Token-based Auth</figcaption>
</figure>
<ul>
<li>✅: Stateless -&gt; Token contains all info to get verified, no copy
on server needed</li>
<li>✅: Valid on multiple domains</li>
<li>✅: No userinfo in token</li>
<li>✅: Not vulnerable for XSRF attacks</li>
<li>❌: Validity of token can not be revoked</li>
<li>❌: Vulnerable for XSS attacks</li>
</ul>
<h4 id="oauth2">OAuth2</h4>
<dl>
<dt><strong>OAuth2</strong></dt>
<dd>
authorization framework that enables third-party applications to access
certain resources on behalf of a user, without necessarily sharing the
user’s credentials. It’s commonly used for delegated access, allowing
applications to act on behalf of users to access their data on different
services.
</dd>
</dl>
<p><strong>Parties:</strong></p>
<ol type="1">
<li><strong>Resource Owner</strong>: End user, owner of the data</li>
<li><strong>Client</strong>: Application that wants to access user’s
data (eg: Spotify)</li>
<li><strong>Authorization Server</strong>: Manages authorization and
authentication, issues access tokens (eg: Facebook Auth server)</li>
<li><strong>Resource Server</strong>: Holds protected resources that
client wants to access (eg: facebook.com)</li>
</ol>
<p><strong>Flow</strong>:</p>
<ol type="1">
<li><strong>Authorization Request</strong>:
<ul>
<li>The client requests authorization from the resource owner to access
its resources.</li>
<li>This request is redirected to the authorization server.</li>
</ul></li>
<li><strong>User Authorization</strong>: Resource owner grants concent
to log in to auth server</li>
<li><strong>Authorization Grant</strong>: Auth server sends back
authorization grant and auth code back to client.</li>
<li><strong>Access Token Request</strong>: Client request <em>access
token</em> form auth server by presenting it with its auth grant and
auth code.</li>
<li><strong>Access Token Grant</strong>: If the authorization server
verifies the client and authorization grant, it issues an access token
to the client.</li>
<li><strong>Accessing Protected resources</strong>:
<ul>
<li>Client requests rousources from resource server (eg: profile picture
and friends)</li>
<li>Client includes token in header</li>
</ul></li>
</ol>
<figure>
<img src="./img/OAuth2-grand-flow.png" alt="OAuth2 Grand flow" />
<figcaption aria-hidden="true">OAuth2 Grand flow</figcaption>
</figure>
<p><strong>Types of Grants</strong>:</p>
<ul>
<li>Authorization Code: when client is a webserver</li>
<li>Implicit: when client is a js-app in browser</li>
<li>Resource owner password credential: when client and auth server are
from same authority</li>
<li>Client credentials: when client is the resource owner</li>
</ul>
<p><strong>OAuth vulnerabilities</strong>:</p>
<ul>
<li>❌: Access token is available in js in browser</li>
<li>❌: Attacker can make ordinary service (client) that requires OAuth
signup -&gt; uses obtained token to get access to other resource servers
that use same OAuth service</li>
<li>✅: Solution -&gt; auth server provides additional information about
token (check if proper client = <strong>Proof Key for Code
Exchange</strong>)</li>
</ul>
<h4 id="single-sign-on-sso">Single Sign On (SSO)</h4>
<ul>
<li>Login once for different webapps</li>
<li>Single point of failure</li>
<li>Can be implemented with OAuth or SAML</li>
</ul>
<h4 id="two-factor-authentication-2fa">Two Factor Authentication
(2FA)</h4>
<p>Authentication involves multiple steps. Possible over multiple
devices.</p>
<h3 id="most-common-vulnerabilities">10.2 Most common
vulnerabilities</h3>
<h4 id="injection">1. Injection</h4>
<p>The injection of SQL into ordinary input fields/parameters (XSS)</p>
<h4 id="id-and-authentication-failures">2. Id and Authentication
failures</h4>
<p>Bad implementation of authentication and sessionmanagement. Attacker
gets access to passwords, keys or sessiontokens.</p>
<h4 id="cryptographic-failures">3. Cryptographic Failures</h4>
<p>Sensitive data not suffitiently protected because of bad or old
cryptography implementation.</p>
<blockquote>
<p>💡: Use existing, well respected frameworks to implement
cryptography.</p>
</blockquote>
<h4 id="insecure-design">4. Insecure design</h4>
<p>Bad design, not tested agains common vulnerabilities.</p>
<h4 id="broken-access-control">5. Broken Access Control</h4>
<p>Users have to many access rights (attacker gets right to other
accounts, files, databases, …)</p>
<h4 id="security-misconfiguration">6. Security Misconfiguration</h4>
<ul>
<li>Outdated software</li>
<li>Unsafe default configuration (default passwords)</li>
</ul>
<h4 id="server-side-request-forgery-ssrf">7. Server-Side request forgery
(SSRF)</h4>
<p>Using an insecure server to gain access to intern data (eg: urls as
parameter in response).</p>
<h4 id="software-and-data-integrity-failures">8. Software and Data
Integrity Failures</h4>
<p>Using libraries of untrusted sources, or having an unsafe CI/CD
pipeline.</p>
<h4 id="vulnerable-and-outdated-components">9. Vulnerable and outdated
components</h4>
<p>Newer version often contain patches for 0-days.</p>
            </div>
    </div>
  </div>
  <script src="https://vjs.zencdn.net/5.4.4/video.js"></script>

</body>
</html>
