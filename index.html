<!doctype html>
<html >
<head>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!--[if lt IE 9]>
                <script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
        <![endif]-->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />

    <!-- <link rel="stylesheet" type="text/css" href="template.css" /> -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/template.css" />

    <link href="https://vjs.zencdn.net/5.4.4/video-js.css" rel="stylesheet" />

    <script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
    <!-- <script type='text/javascript' src='menu/js/jquery.cookie.js'></script> -->
    <!-- <script type='text/javascript' src='menu/js/jquery.hoverIntent.minified.js'></script> -->
    <!-- <script type='text/javascript' src='menu/js/jquery.dcjqaccordion.2.7.min.js'></script> -->

    <!-- <link href="menu/css/skins/blue.css" rel="stylesheet" type="text/css" /> -->
    <!-- <link href="menu/css/skins/graphite.css" rel="stylesheet" type="text/css" /> -->
    <!-- <link href="menu/css/skins/grey.css" rel="stylesheet" type="text/css" /> -->
  
    <!-- <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->
        
  
    <!-- <script src="script.js"></script> -->
  
    <!-- <script src="jquery.sticky-kit.js "></script> -->
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.cookie.js'></script>
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.hoverIntent.minified.js'></script>
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.dcjqaccordion.2.7.min.js'></script>

    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/blue.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/graphite.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/grey.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/ryangrose/easy-pandoc-templates@948e28e5/css/elegant_bootstrap.css" rel="stylesheet" type="text/css" />
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  
    <script src="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/script.js"></script>
  
    <script src="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/jquery.sticky-kit.js"></script>
    <meta name="generator" content="pandoc" />
  <title>Frameworks summary</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>

    
    <div class="navbar navbar-static-top">
    <div class="navbar-inner">
      <div class="container">
        <span class="doc-title">Frameworks summary</span>
        <ul class="nav pull-right doc-info">
                            </ul>
      </div>
    </div>
  </div>
    <div class="container">
    <div class="row">
            <div id="TOC" class="span3">
        <div class="well toc">

        <ul>
        <li><a href="#frameworks-summary"
        id="toc-frameworks-summary">Frameworks summary</a>
        <ul>
        <li><a href="#rest" id="toc-rest">1. REST</a>
        <ul>
        <li><a href="#http-refresher" id="toc-http-refresher">1.1 HTTP
        refresher</a></li>
        <li><a href="#rest-webservices" id="toc-rest-webservices">1.2
        Rest webservices</a></li>
        <li><a href="#rest-webservices-java-springboot"
        id="toc-rest-webservices-java-springboot">1.3 Rest webservices:
        Java (<em>Springboot</em>)</a></li>
        <li><a href="#testing-webservices"
        id="toc-testing-webservices">1.4 Testing webservices</a></li>
        <li><a href="#webservices-security"
        id="toc-webservices-security">1.5 Webservices security</a></li>
        </ul></li>
        <li><a href="#orm" id="toc-orm">2. ORM</a>
        <ul>
        <li><a href="#orm-object-relational-mapping"
        id="toc-orm-object-relational-mapping">2.1 ORM: Object
        Relational Mapping</a></li>
        <li><a href="#jpa-in-spring" id="toc-jpa-in-spring">2.2 JPA in
        Spring</a></li>
        <li><a href="#orm-inheritance" id="toc-orm-inheritance">2.3 ORM
        Inheritance</a></li>
        <li><a href="#orm-associations-value-objects"
        id="toc-orm-associations-value-objects">2.4 ORM associations:
        value-objects</a></li>
        <li><a href="#orm-associations-relations"
        id="toc-orm-associations-relations">2.5 ORM associations:
        relations</a></li>
        <li><a href="#how-does-jpa-work" id="toc-how-does-jpa-work">2.6
        How does JPA work?</a></li>
        </ul></li>
        <li><a href="#node.js" id="toc-node.js">3. Node.js</a>
        <ul>
        <li><a href="#example-http-server-in-node.js"
        id="toc-example-http-server-in-node.js">3.1 Example HTTP-server
        in Node.js</a></li>
        <li><a href="#routing" id="toc-routing">3.2 Routing</a></li>
        <li><a href="#the-node.js-system"
        id="toc-the-node.js-system">3.3 The Node.js system</a></li>
        <li><a href="#express.js" id="toc-express.js">3.4
        Express.js</a></li>
        </ul></li>
        <li><a href="#websockets" id="toc-websockets">4.
        Websockets</a></li>
        <li><a href="#reactive-rest-webservices"
        id="toc-reactive-rest-webservices">5. Reactive REST
        webservices</a>
        <ul>
        <li><a href="#data-streams" id="toc-data-streams">5.1 Data
        streams</a></li>
        <li><a href="#observer-and-observables"
        id="toc-observer-and-observables">5.2 Observer and
        observables</a></li>
        <li><a href="#reactor-java" id="toc-reactor-java">5.3 Reactor
        Java</a></li>
        </ul></li>
        <li><a href="#jdbc" id="toc-jdbc">6. JDBC</a>
        <ul>
        <li><a href="#jdbc-drivers" id="toc-jdbc-drivers">6.1 JDBC
        drivers</a></li>
        <li><a href="#jdbc-example" id="toc-jdbc-example">6.2 JDBC
        Example</a></li>
        <li><a href="#sql-injection" id="toc-sql-injection">6.3
        SQL-injection</a></li>
        <li><a href="#driver-vs-datasource"
        id="toc-driver-vs-datasource">6.4 Driver vs DataSource</a></li>
        <li><a href="#orm-v-jdbc" id="toc-orm-v-jdbc">6.5 ORM v
        JDBC</a></li>
        </ul></li>
        </ul></li>
        </ul>

        </div>
      </div>
            <div class="span9">

      
      <h1 id="frameworks-summary">Frameworks summary</h1>
<h2 id="rest">1. REST</h2>
<h3 id="http-refresher">1.1 HTTP refresher</h3>
<ul>
<li>Client-server protocol</li>
<li>Transport protocol: TCP on port 80</li>
<li>Request-response</li>
</ul>
<h4 id="http-request">HTTP Request</h4>
<p>Request types:</p>
<ul>
<li>GET</li>
<li>POST</li>
<li>PUT</li>
<li>DELETE</li>
<li>HEAD</li>
<li>OPTIONS</li>
</ul>
<p>Statuscodes:</p>
<ul>
<li>1xx: Informative</li>
<li>2xx: Success</li>
<li>3xx: Redirection</li>
<li>4xx: Client error</li>
<li>5xx: Server error</li>
</ul>
<h3 id="rest-webservices">1.2 Rest webservices</h3>
<p>REST stands for Representational State Transfer. Itâ€™s an
architectural style used for designing networked applications,
especially web services. REST relies on a client-server architecture
where the client interacts with the server via requests to access and
manipulate resources on the server</p>
<ul>
<li><strong>Client-server</strong></li>
<li><strong>Stateless</strong>: server doesnâ€™t store any client
context</li>
<li><strong>Uniform interface</strong>: independent of type of
client</li>
<li><strong>Cacheable</strong>: responses from REST service can specify
to cache for a specified period. (using the <code>Cache-Control</code>
header field)</li>
<li><strong>Layered system</strong>: client doesnâ€™t now which layer it
is connected to</li>
<li><strong>Code on demand</strong>: Content of message can also be
code</li>
<li>Resource-based: can be any data or service that the app exposes,
resources is identifiable via a URI</li>
<li>CRUD operations: Must support GET, POST, PUT, DELETE methods.</li>
<li>Representational resources: could be represented by multiple
representations (JSON, XML, â€¦)</li>
</ul>
<h4 id="uri-uniform-resource-identifier">URI (Uniform Resource
Identifier)</h4>
<p>URIâ€™s are hierarchical structures that represent a resource on which
CRUD actions can be performed.</p>
<p>hierarchical:
<code>http://www.myservice.org/discussions/{year}/{day}/{month}/{topic}</code></p>
<p>It is also possible to add parameters to the URI to filter or sort on
a resources:
<code>http://www.myservice.org/discussions?region=USA&amp;year=2023</code></p>
<h4 id="glory-of-rest">Glory of REST</h4>
<figure>
<img src="./img/glory-of-rest.png" alt="Glory of REST" />
<figcaption aria-hidden="true">Glory of REST</figcaption>
</figure>
<h5 id="level-0-the-swamp-of-pox">Level 0: The swamp of pox</h5>
<ul>
<li>One endpoint</li>
<li>HTTP only as transport</li>
<li>Remote procedure invocation
(<code>POST &lt;openSlotRequest</code>)</li>
</ul>
<h5 id="level-1-resources">Level 1: Resources</h5>
<ul>
<li>Multiple endpoints</li>
<li>Arguments in body (<code>POST &lt;appointmentRequest</code>)</li>
</ul>
<h5 id="level-2-http-methods">Level 2: HTTP-methods</h5>
<ul>
<li>HTTP-methods as CRUD (<code>GET ?date=20231224</code>)</li>
<li>HTTP-statuscodes as response
(<code>200 OK &lt;openSlotList</code>)</li>
</ul>
<h5 id="level-3-hypermedia-controls">Level 3: Hypermedia controls</h5>
<ul>
<li>HATEOAS (Hypertext As The Engine Of Application State)</li>
<li>Links to other resources in response</li>
<li>Selfdocumenting protocol</li>
</ul>
<h3 id="rest-webservices-java-springboot">1.3 Rest webservices: Java
(<em>Springboot</em>)</h3>
<p><strong>Why springboot?</strong></p>
<p>Spring avoids a lot of manual configuration and is easy to manage
dependently.</p>
<h4 id="spring-architecture">Spring architecture</h4>
<figure>
<img src="./img/spring-architecture.png"
alt="Architecture REST API in Spring" />
<figcaption aria-hidden="true">Architecture REST API in
Spring</figcaption>
</figure>
<ol type="1">
<li>Spring-framework receives HTTP-req and determines which
<em>method</em> of which <em>controller</em> has to get called.</li>
<li>(Opt) Convert JSON in body to specific object</li>
<li>(Opt) Validate input values of object</li>
<li>Call method of <em>controller</em> with object as param</li>
<li><em>Controller</em> calls underlying logic</li>
<li>Logic interacts with data-layer</li>
<li>Result of <em>controller</em> gets serialized to JSON</li>
<li>HTTP-response gets generated (possibly with JSON-object in
body)</li>
</ol>
<h4 id="get-controller">GET controller</h4>
<div class="sourceCode" id="cb1"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">springframework</span><span class="op">.</span><span class="im">web</span><span class="op">.</span><span class="im">bind</span><span class="op">.</span><span class="im">annotation</span><span class="op">.*;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="at">@RestController</span> <span class="co">// Indicate that this class is a RestController</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="at">@RequestMapping</span><span class="op">(</span><span class="st">&quot;agenda&quot;</span><span class="op">)</span> <span class="co">//The path to access agendas (eg: localhost:8080/agenda)</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> AgendaController <span class="op">{</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> Agenda agenda<span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  pubic <span class="fu">AgendaController</span><span class="op">(</span>Agenda agenda<span class="op">)</span> <span class="op">{</span> <span class="kw">this</span><span class="op">.</span><span class="fu">agenda</span> <span class="op">=</span> agenda<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">@GetMapping</span> <span class="co">// Indicate that method handles Get-requests</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="bu">Collection</span><span class="op">&lt;</span>AgendaItem<span class="op">&gt;</span> <span class="fu">agendaFromNow</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> agenda<span class="op">.</span><span class="fu">getAgendaItem</span><span class="op">(</span><span class="kw">new</span> <span class="bu">Date</span><span class="op">());</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<ul>
<li><code>@RestController</code>:
<ul>
<li>Normal class</li>
<li>Wrapped in a <code>serverlet</code></li>
<li>REST-service</li>
</ul></li>
<li><code>@RequestMapping</code>:
<ul>
<li>Specifies which path a REST-service needs to handle.</li>
</ul></li>
<li><code>@GetMapping</code>:
<ul>
<li>Specifies which HTTP-method a method response to</li>
<li>Result is automatically converted to JSON</li>
<li>Can have a path as parameter (eg
<code>GetMapping("/id/{id}")</code>)
<ul>
<li>Param can be retrieved using <code>@RequestParam("id")</code></li>
</ul></li>
</ul></li>
<li><code>@PostMapping</code>:
<ul>
<li>Body can be retrieved using
<code>@RequestBody AgendaItem item</code></li>
</ul></li>
</ul>
<h5 id="dependency-injection">Dependency injection</h5>
<p>DI is needed to make the Agenda class (dependency) available to the
to <code>RestController</code>.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Component</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> Agenda <span class="op">{</span><span class="kw">...</span><span class="op">}</span></span></code></pre></div>
<h5 id="method-response-status">Method response status</h5>
<p>A REST-method typically returns a <code>ResponseEntity</code> (along
with a message).</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="at">@GetMapping</span><span class="op">(</span><span class="st">&quot;/age&quot;</span><span class="op">)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>ResponseEntity<span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;</span> <span class="fu">age</span><span class="op">(</span><span class="at">@RequestParam</span><span class="op">(</span><span class="st">&quot;yearOfBirth&quot;</span><span class="op">)</span> <span class="dt">int</span> yearOfBirth<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span><span class="fu">invalidAge</span><span class="op">(</span>yearOfBirth<span class="op">))</span> <span class="op">{</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> ResponseEntity<span class="op">&lt;&gt;(</span><span class="st">&quot;Invalid year of birth&quot;</span><span class="op">,</span> HttpStatus<span class="op">.</span><span class="fu">BAD_REQUEST</span><span class="op">);</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">new</span> ResponseEntity<span class="op">&lt;&gt;(</span><span class="st">&quot;YOB is &quot;</span> <span class="op">+</span> yearOfBirth<span class="op">,</span> HttpStatus<span class="op">.</span><span class="fu">OK</span><span class="op">);</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>It is also possible to couple a statuscode to an exception:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="at">@ResponseStatus</span><span class="op">(</span>code <span class="op">=</span> HttpStatus<span class="op">.</span><span class="fu">BAD_REQUEST</span><span class="op">)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CustomException <span class="kw">extends</span> <span class="bu">RuntimeException</span> <span class="op">{}</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="at">@PostMapping</span><span class="op">()</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="at">@ResponseStatus</span><span class="op">(</span>HttpStatus<span class="op">.</span><span class="fu">CREATED</span><span class="op">)</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">storeEmployee</span><span class="op">(</span><span class="at">@RequestBody</span> Employee employee<span class="op">)</span> <span class="op">{</span><span class="kw">...</span><span class="op">}</span></span></code></pre></div>
<p>Here the <code>ResponseStatus</code> will automatically return a 201
if the creation of employee was successful.</p>
<p>Finally it is also common to respond with a URI.</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="at">@PostMapping</span><span class="op">(</span><span class="st">&quot;/user/{username}&quot;</span><span class="op">)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> ResponseEntity<span class="op">&lt;</span><span class="bu">Void</span><span class="op">&gt;</span> <span class="fu">createTodo</span><span class="op">(</span><span class="at">@PathVariable</span> <span class="bu">String</span> username<span class="op">,</span> <span class="at">@RequestBody</span> Todo todo<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  todo<span class="op">.</span><span class="fu">setUsername</span><span class="op">(</span>username<span class="op">);</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  Todo createdTodo <span class="op">=</span> toJpaRepo<span class="op">.</span><span class="fu">save</span><span class="op">(</span>todo<span class="op">);</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="bu">URI</span> uri <span class="op">=</span> ServletUriComponentsBuilder<span class="op">.</span><span class="fu">fromCurrentRequest</span><span class="op">()</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">path</span><span class="op">(</span><span class="st">&quot;/id&quot;</span><span class="op">).</span><span class="fu">buildAndExpand</span><span class="op">(</span>createdTodo<span class="op">.</span><span class="fu">getId</span><span class="op">()).</span><span class="fu">toUri</span><span class="op">();</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> ResponseEntity<span class="op">.</span><span class="fu">created</span><span class="op">(</span>uri<span class="op">).</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="testing-webservices">1.4 Testing webservices</h3>
<h4 id="unit-tests-junit">Unit tests (Junit)</h4>
<p><strong>Fixture</strong>:</p>
<ul>
<li>Fixed context</li>
<li>baseline state</li>
</ul>
<p>Four phases:</p>
<ol type="1">
<li>Setup: Prepare text fixture</li>
<li>Exercise: Interact with system to research</li>
<li>Verify: Verify if it behaves as expected</li>
<li>Tear down: Break down text fixture to original state</li>
</ol>
<div class="sourceCode" id="cb7"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="at">@ExtendWith</span><span class="op">(</span>SpringExtension<span class="op">.</span><span class="fu">class</span><span class="op">)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="at">@SpringBootTest</span><span class="op">(</span>webEnvironment <span class="op">=</span> WebEnvironment<span class="op">.</span><span class="fu">RANDOM_PORT</span><span class="op">)</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="at">@AutoConfigureWebTestClient</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="at">@ActiveProfile</span><span class="op">(</span><span class="st">&quot;test&quot;</span><span class="op">)</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> RestAgendaApplicationTest <span class="op">{</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Autowired</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> WebTestClient webClient<span class="op">;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Test</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="dt">void</span> <span class="fu">testGetAllRepos</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    WebTestClient<span class="op">.</span><span class="fu">get</span><span class="op">().</span><span class="fu">uri</span><span class="op">(</span><span class="st">&quot;/api/repos&quot;</span><span class="op">)</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">accept</span><span class="op">(</span>MediaType<span class="op">.</span><span class="fu">APPLICATION_JSON_UTF8</span><span class="op">)</span>  <span class="co">// Set header</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">exchange</span><span class="op">()</span>                               <span class="co">// Send message</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">expectStatus</span><span class="op">().</span><span class="fu">isOk</span><span class="op">()</span>                    <span class="co">// Check status</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">expectHeader</span><span class="op">().</span><span class="fu">contentType</span><span class="op">(</span>MediaType<span class="op">.</span><span class="fu">APPLICATION_JSON_UTF8</span><span class="op">)</span> <span class="co">// Check header</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">expectedBodyList</span><span class="op">(</span>Repo<span class="op">.</span><span class="fu">class</span><span class="op">)</span>             <span class="co">// Check body</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The <code>@ActiveProfile</code> annotation is optional but is very
useful. It letâ€™s us use a different bean configured specifically for
testing purposes.</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Component</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="at">@Profile</span><span class="op">(</span><span class="st">&quot;test&quot;</span><span class="op">)</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> DummyDao <span class="kw">implements</span> Dao <span class="op">{</span><span class="kw">...</span><span class="op">}</span></span></code></pre></div>
<h3 id="webservices-security">1.5 Webservices security</h3>
<h4 id="authentication">Authentication</h4>
<p>Configure login information</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Configuration</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="at">@EnableWebSecurity</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> SecurityConfig <span class="op">{</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Bean</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> UserDetailsService <span class="fu">userDetailsService</span><span class="op">(</span>BCryptPasswordEncoder bCryptPasswordEncoder<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    InMemoryUserDetailsManager manager <span class="op">=</span> <span class="kw">new</span> <span class="fu">InMemoryUserDetailsManager</span><span class="op">();</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    manager<span class="op">.</span><span class="fu">createUser</span><span class="op">(</span>User<span class="op">.</span><span class="fu">withUsername</span><span class="op">(</span><span class="st">&quot;user&quot;</span><span class="op">)</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">password</span><span class="op">(</span>bCryptPasswordEncoder<span class="op">.</span><span class="fu">encode</span><span class="op">(</span><span class="st">&quot;userPass&quot;</span><span class="op">))</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">roles</span><span class="op">(</span><span class="st">&quot;USER&quot;</span><span class="op">)</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">build</span><span class="op">());</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    manager<span class="op">.</span><span class="fu">createUser</span><span class="op">(</span>User<span class="op">.</span><span class="fu">withUsername</span><span class="op">(</span><span class="st">&quot;admin&quot;</span><span class="op">)</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">password</span><span class="op">(</span>bCryptPasswordEncoder<span class="op">.</span><span class="fu">encode</span><span class="op">(</span><span class="st">&quot;adminPass&quot;</span><span class="op">))</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">roles</span><span class="op">(</span><span class="st">&quot;USER&quot;</span><span class="op">,</span> <span class="st">&quot;ADMIN&quot;</span><span class="op">)</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">build</span><span class="op">());</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> manager<span class="op">;</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="kw">...</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="authorization">Authorization</h4>
<p>Assign roles to users and restrict certain roles from performing
certain actions.</p>
<figure>
<img src="./img/authorization.png" alt="Authorization" />
<figcaption aria-hidden="true">Authorization</figcaption>
</figure>
<p><strong>Allow certain roles webservice:</strong>
(<code>anyRequest()</code>)</p>
<p><strong>Allow certain roles on some paths:</strong>
(<code>requestMatchers(path)</code>)</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Configuration</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="at">@EnableWebSecurity</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> SecurityConfig <span class="op">{</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Bean</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> SecurityFilterChain <span class="fu">securityFilterChain</span><span class="op">(</span>HttpSecurity http<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Exception</span> <span class="op">{</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    http</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">authorizeHttpRequests</span><span class="op">((</span>authz<span class="op">)</span> <span class="op">-&gt;</span> authz</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">requestMatchers</span><span class="op">(</span><span class="st">&quot;/api/admin/**&quot;</span><span class="op">).</span><span class="fu">hasRole</span><span class="op">(</span><span class="st">&quot;ADMIN&quot;</span><span class="op">)</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">requestMatchers</span><span class="op">(</span><span class="st">&quot;/api/user/**&quot;</span><span class="op">).</span><span class="fu">hasRole</span><span class="op">(</span><span class="st">&quot;USER&quot;</span><span class="op">)</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">anyRequest</span><span class="op">().</span><span class="fu">authenticated</span><span class="op">()</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>      <span class="op">);</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> http<span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="kw">...</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Allow certain roles on some webservice methods:</strong>
(<code>@EnableMethodSecurity()</code>)</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Configuration</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="at">@EnableMethodSecurity</span><span class="op">(</span>prePostEnabled <span class="op">=</span> <span class="kw">true</span><span class="op">,</span> securedEnabled <span class="op">=</span> <span class="kw">true</span><span class="op">,</span> jsr250Enabled <span class="op">=</span> <span class="kw">true</span><span class="op">)</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> SecurityConfig <span class="op">{</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">@RolesAllowed</span><span class="op">(</span><span class="st">&quot;ROLE_VIEWER&quot;</span><span class="op">)</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="bu">String</span> <span class="fu">getUser</span><span class="op">();</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">@RolesAllowed</span><span class="op">({</span> <span class="st">&quot;ROLE_ADMIN&quot;</span><span class="op">,</span> <span class="st">&quot;ROLE_EDITOR&quot;</span> <span class="op">})</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="dt">void</span> <span class="fu">deleteUser</span><span class="op">();</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="csrf-cross-site-request-forgery">CSRF: Cross Site Request
Forgery</h4>
<p>CSRF is an attack where an attacker tricks a userâ€™s browser into
making an unintended and unauthorized request to a different website,
exploiting the userâ€™s authenticated session.</p>
<p><strong>How to defend against CSRF?</strong></p>
<p>Make distinction between real and fake HTTP-request by using a
<strong>Synchronizer Token Pattern</strong> or
<strong>SameSite-attribute cookie</strong>.</p>
<p>Both methods generate a token for the client on login. Then every
time the client interacts with the server, the client includes that
token in its request. On every request, the server will validate if it
received a valid token. These tokens have a certain expiration date to
avoid problems upon token theft.</p>
<blockquote>
<p>ðŸ’¡: In Spring, CSRF security is enabled by default.</p>
</blockquote>
<hr />
<h2 id="orm">2. ORM</h2>
<h3 id="orm-object-relational-mapping">2.1 ORM: Object Relational
Mapping</h3>
<p>ORM is a programming technique that allows devs to work with objects
in the code while transparently persisting and retrieving data from a
relational database. It allows devs to define how objects/classes map to
database tables and vice versa. Each object corresponds to a table in
the database.</p>
<h4 id="object-relational-impedance-mismatch">Object-relational
impedance mismatch</h4>
<p>There are a lot of concepts in OOP that resembles the structure of
Relational databases: - Identities - Relations - Inheritance</p>
<p>There are a couple requirements to be able to map an object to a
DB.</p>
<ol type="1">
<li>Object must have same <em>Primary Key</em> as DB table.</li>
<li>Relationships should be the same</li>
<li>Each field of the object should map to column in the database</li>
</ol>
<h4 id="orm-in-java">ORM in java</h4>
<p>Using the <em>JPA (Java Persistence API)</em>. Every dataclass must
be a Java Bean.</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Entity</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="at">@Table</span><span class="op">(</span>name <span class="op">=</span> <span class="st">&quot;sportclub&quot;</span><span class="op">)</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> Sportclub <span class="op">{</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">Long</span> id<span class="op">;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">String</span> name<span class="op">;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Id</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">@GeneratedValue</span><span class="op">(</span>strategy<span class="op">=</span>GenerationType<span class="op">.</span><span class="fu">IDENTITY</span><span class="op">)</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="bu">Long</span> <span class="fu">getId</span><span class="op">()</span> <span class="op">{</span> <span class="cf">return</span> id<span class="op">;</span> <span class="op">}</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setId</span><span class="op">(</span><span class="bu">Long</span> id<span class="op">)</span> <span class="op">{</span> <span class="kw">this</span><span class="op">.</span><span class="fu">id</span> <span class="op">=</span> id<span class="op">;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="bu">String</span> <span class="fu">getName</span><span class="op">()</span> <span class="op">{</span> <span class="cf">return</span> name<span class="op">;</span> <span class="op">}</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setName</span><span class="op">(</span><span class="bu">String</span> name<span class="op">)</span> <span class="op">{</span> <span class="kw">this</span><span class="op">.</span><span class="fu">name</span> <span class="op">=</span> name<span class="op">;</span> <span class="op">}</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>There are a couple different strategies to assign a new Primary
Key:</p>
<ul>
<li>AUTO: Automatically choose strategy</li>
<li>IDENTITY: Relies on an auto-incremented column in the database</li>
<li>SEQUENCE: Utilizes a database sequence to generate primary key</li>
<li>TABLE: Requires an extra table to keep track of the next available
id</li>
</ul>
<h3 id="jpa-in-spring">2.2 JPA in Spring</h3>
<figure>
<img src="./img/jpa-config.png" alt="JPA configuration" />
<figcaption aria-hidden="true">JPA configuration</figcaption>
</figure>
<h4 id="jpa-repository">JPA Repository</h4>
<p>The <code>JpaRepository</code> is an interface that is a
CRUD-repository with extra functionalities for performing database
operations.</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Typically defined in a single file (like ProductRepository.java)</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">interface</span> ProductRepository <span class="kw">extends</span> JpaRepository<span class="op">&lt;</span>Product<span class="op">,</span> <span class="bu">Long</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>      <span class="bu">List</span><span class="op">&lt;</span>Product<span class="op">&gt;</span> <span class="fu">findByCategory</span><span class="op">(</span><span class="bu">String</span> category<span class="op">);</span> <span class="co">// Optional custom user-defined queries</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Example usage of build-in queries:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ProductDao.java</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="at">@Service</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> ProductDao<span class="op">{</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="dt">final</span> ProductRepository repo<span class="op">;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">ProductDao</span><span class="op">(</span>ProductRepository repository<span class="op">)</span> <span class="op">{</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">repo</span> <span class="op">=</span> repository<span class="op">;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="bu">List</span><span class="op">&lt;</span>Product<span class="op">&gt;</span> <span class="fu">getProductsByCategory</span><span class="op">(</span><span class="bu">String</span> category<span class="op">)</span> <span class="op">{</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> productRepository<span class="op">.</span><span class="fu">findByCategory</span><span class="op">(</span>category<span class="op">);</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> Product <span class="fu">getProductById</span><span class="op">(</span><span class="dt">long</span> id<span class="op">)</span> <span class="op">{</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> repo<span class="op">.</span><span class="fu">findById</span><span class="op">(</span>id<span class="op">).</span><span class="fu">orElse</span><span class="op">(</span><span class="kw">null</span><span class="op">);</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="dt">void</span> <span class="fu">addProduct</span><span class="op">(</span>Product p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    repo<span class="op">.</span><span class="fu">save</span><span class="op">(</span>addProduct<span class="op">);</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>List of build-in methods:</p>
<ul>
<li><code>save</code>: save new object</li>
<li><code>findAll</code>: return all entities</li>
<li><code>findAllById</code>: return all with certain id</li>
<li><code>flush</code>: write changes to DB</li>
<li><code>saveAll</code>: Save list of objects</li>
<li><code>delete</code>, <code>deleteAll</code>: remove
entity/entities</li>
<li><code>existById</code>: does entity exist?</li>
</ul>
<blockquote>
<p>âš ï¸: Using a JPA requires some configuration in
<code>application.properties</code></p>
</blockquote>
<pre class="text"><code>spring.datasource.url=jdbc:mysql://localhost:3306/dudosdb?serverTimezone=UTC
spring.datasource.username=TLuca
spring.datasource.password=&lt;redacted&gt;</code></pre>
<h3 id="orm-inheritance">2.3 ORM Inheritance</h3>
<p>There are different annotation to indicate what type of inheritance
an object is subject to.</p>
<ul>
<li><code>@Inheritance(strategy = ...)</code>: Sets how entities are
stored in the DB (default = <code>SINGLE_TABLE</code>)</li>
<li><code>@DiscriminatorColumn(name = "...", discriminatorType= ...)</code>:
Defines a column that distinguishes entity types in a single table
inheritance strategy.</li>
<li><code>@DiscriminatorValue("K")</code>: Assigns a specific value to
differentiate an entity type in a single table inheritance setup</li>
<li><code>@PrimaryKeyJoinColumn(name = "...")</code>: Maps a parent
tableâ€™s primary key as a foreign key in the child table in joined table
inheritance.</li>
</ul>
<h3 id="orm-associations-value-objects">2.4 ORM associations:
value-objects</h3>
<p>Associations:</p>
<ul>
<li>Direction:
<ul>
<li>Unidirectional</li>
<li>Bidirectional</li>
</ul></li>
<li>Multiplicity:
<ul>
<li>1-to-1</li>
<li>1-to-many</li>
<li>many-to-many</li>
</ul></li>
</ul>
<p>Value-objects criteria:</p>
<ul>
<li>Value-obj belongs to just one entity</li>
<li>Entity disappears -&gt; value-object disappears</li>
<li>An entity has an <em>identifier</em></li>
</ul>
<h4 id="value-object-example">Value-object example</h4>
<figure>
<img src="./img/example-value-obj.png" alt="Example value-obj" />
<figcaption aria-hidden="true">Example value-obj</figcaption>
</figure>
<p>It doesnâ€™t make sense to save the value-object (<code>Address</code>)
in a separate table. So we can store the <code>Address</code> in the
same table in multiple <code>Embedded columns</code>.</p>
<p>We would also like to make an association to a separate table
containing all the email addresses.</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Embeddable</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> Address <span class="op">{</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">String</span> street<span class="op">;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">String</span> city<span class="op">;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">String</span> state<span class="op">;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">String</span> zipCode<span class="op">;</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Getters, setters, constructors, etc.</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="at">@Entity</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="at">@Table</span><span class="op">(</span>name <span class="op">=</span> <span class="st">&quot;sportclub&quot;</span><span class="op">)</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> sportclub <span class="op">{</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Id</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">Long</span> id<span class="op">;</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">String</span> name<span class="op">;</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Embedded</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> Address address<span class="op">;</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">@ElementCollection</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">@CollectionTable</span><span class="op">(</span>name <span class="op">=</span> <span class="st">&quot;emailaddresses&quot;</span><span class="op">,</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  joinColumns <span class="op">=</span> <span class="at">@JoinColumn</span><span class="op">(</span>name <span class="op">=</span> <span class="st">&quot;sportclub&quot;</span><span class="op">))</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Column</span><span class="op">(</span>name<span class="op">=</span><span class="st">&quot;email&quot;</span><span class="op">)</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="orm-associations-relations">2.5 ORM associations: relations</h3>
<p>Different mappings of associations of entities:</p>
<ol type="1">
<li>One-to-One Relationship:</li>
</ol>
<ul>
<li><code>@OneToOne</code>: Defines a one-to-one relationship between
two entities.</li>
<li><code>@JoinColumn</code>: Specifies the column used for joining two
entities in a one-to-one relationship.</li>
</ul>
<ol start="2" type="1">
<li>One-to-Many Relationship:</li>
</ol>
<ul>
<li><code>@OneToMany</code>: Represents a one-to-many relationship
between two entities.</li>
<li><code>@JoinColumn</code> (within <code>@OneToMany</code>): Specifies
the column in the â€œmanyâ€ side entity to join with the â€œoneâ€ side
entity.</li>
</ul>
<ol start="3" type="1">
<li>Many-to-One Relationship:</li>
</ol>
<ul>
<li><code>@ManyToOne</code>: Specifies a many-to-one relationship
between two entities.</li>
<li><code>@JoinColumn</code> (within <code>@ManyToOne</code>): Specifies
the column in the â€œmanyâ€ side entity that references the â€œoneâ€ side
entity.</li>
</ul>
<ol start="4" type="1">
<li>Many-to-Many Relationship:</li>
</ol>
<ul>
<li><code>@ManyToMany</code>: Defines a many-to-many relationship
between two entities.</li>
<li><code>@JoinTable</code>: Specifies the join table for the
many-to-many relationship, defining the columns and their mappings.</li>
</ul>
<p>For detailed examples of relations (with annotation parameters) see:
<a href="https://www.baeldung.com/jpa-hibernate-associations"
class="uri">https://www.baeldung.com/jpa-hibernate-associations</a></p>
<h3 id="how-does-jpa-work">2.6 How does JPA work?</h3>
<figure>
<img src="./img/jpa-operation.png" alt="JPA operation" />
<figcaption aria-hidden="true">JPA operation</figcaption>
</figure>
<blockquote>
<p>â—: TODO</p>
</blockquote>
<hr />
<h2 id="node.js">3. Node.js</h2>
<p>Node.js is a JS runtime environment that runs on the V8 JavaScript
engine.</p>
<h3 id="example-http-server-in-node.js">3.1 Example HTTP-server in
Node.js</h3>
<div class="sourceCode" id="cb17"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> http <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;http&#39;</span>)<span class="op">;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> fs <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;fs&#39;</span>)<span class="op">;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> port <span class="op">=</span> <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">port</span> <span class="op">||</span> <span class="dv">8080</span><span class="op">;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>http<span class="op">.</span><span class="fu">createServer</span>( (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Request on port 8080&quot;</span>)<span class="op">;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="fu">writeHead</span>(<span class="dv">200</span><span class="op">,</span> {</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Content-Type&#39;</span><span class="op">:</span> <span class="st">&#39;text/html&#39;</span><span class="op">,</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Access-Control-Allow-Origin&#39;</span><span class="op">:</span> <span class="st">&#39;*&#39;</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> read <span class="op">=</span> fs<span class="op">.</span><span class="fu">createReadStream</span>(<span class="bu">__dirname</span> <span class="op">+</span> <span class="st">&#39;/index.html&#39;</span>)<span class="op">;</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  read<span class="op">.</span><span class="fu">pipe</span>(res)<span class="op">;</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>})<span class="op">.</span><span class="fu">listen</span>(port)<span class="op">;</span></span></code></pre></div>
<h3 id="routing">3.2 Routing</h3>
<figure>
<img src="./img/routing-nodejs.png" alt="Routing in Node.js" />
<figcaption aria-hidden="true">Routing in Node.js</figcaption>
</figure>
<p>server.js</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> server <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;./start&#39;</span>)<span class="op">;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> router <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;./router&#39;</span>)<span class="op">;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> requestHandlers <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;./handlers&quot;</span>)<span class="op">;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> handler <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>handler[<span class="st">&quot;/&quot;</span>] <span class="op">=</span> requestHandlers<span class="op">.</span><span class="at">home</span><span class="op">;</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>handler[<span class="st">&quot;/show&quot;</span>] <span class="op">=</span> requestHandlers<span class="op">.</span><span class="at">show</span><span class="op">;</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>handler[<span class="st">&quot;/upload&quot;</span>] <span class="op">=</span> requestHandlers<span class="op">.</span><span class="at">upload</span><span class="op">;</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>server<span class="op">.</span><span class="fu">start</span>(router<span class="op">.</span><span class="at">route</span><span class="op">,</span> handler)<span class="op">;</span></span></code></pre></div>
<p>handlers.js</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> fs <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;fs&#39;</span>)<span class="op">;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">home</span>(res) {</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">respond</span>(res<span class="op">,</span><span class="st">&#39;views/home.html&#39;</span>)<span class="op">;</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">show</span>(response) {<span class="op">...</span>}</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">upload</span>(response) {<span class="op">...</span>}</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">respond</span>(response<span class="op">,</span> file) {</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  fs<span class="op">.</span><span class="fu">readFile</span>(file<span class="op">,</span> (err<span class="op">,</span> data) <span class="kw">=&gt;</span> {</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    response<span class="op">.</span><span class="fu">writeHead</span>(<span class="dv">200</span><span class="op">,</span> {<span class="st">&quot;Content-Type&quot;</span><span class="op">:</span> <span class="st">&quot;text/html&quot;</span>})<span class="op">;</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    response<span class="op">.</span><span class="fu">write</span>(data)<span class="op">;</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    response<span class="op">.</span><span class="fu">end</span>()<span class="op">;</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>exports<span class="op">.</span><span class="at">home</span> <span class="op">=</span> home<span class="op">;</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>exports<span class="op">.</span><span class="at">show</span> <span class="op">=</span> show<span class="op">;</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>exports<span class="op">.</span><span class="at">upload</span> <span class="op">=</span> upload<span class="op">;</span></span></code></pre></div>
<p>router.js</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">route</span>(pathname<span class="op">,</span> handler<span class="op">,</span> response) {</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Request for &quot;</span> <span class="op">+</span> pathname)<span class="op">;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (handler[pathname] <span class="op">!==</span> <span class="kw">undefined</span>) {</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> handler[pathname](response)<span class="op">;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;No Method found for &quot;</span> <span class="op">+</span> pathname)<span class="op">;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>exports<span class="op">.</span><span class="at">route</span> <span class="op">=</span> route<span class="op">;</span></span></code></pre></div>
<p>start.js</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> http <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;http&quot;</span>)<span class="op">;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> url <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;url&quot;</span>)<span class="op">;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">start</span>(route<span class="op">,</span> handler) {</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Starting.&quot;</span>)<span class="op">;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  start<span class="op">.</span><span class="at">js</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">onRequest</span>(request<span class="op">,</span> response) {</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> pathname <span class="op">=</span> url<span class="op">.</span><span class="fu">parse</span>(request<span class="op">.</span><span class="at">url</span>)<span class="op">.</span><span class="at">pathname</span><span class="op">;</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> content <span class="op">=</span> <span class="fu">route</span>(pathname<span class="op">,</span> handler<span class="op">,</span> response)<span class="op">;</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>content) {</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>      response<span class="op">.</span><span class="fu">writeHead</span>(<span class="dv">404</span><span class="op">,</span> {<span class="st">&quot;Content-Type&quot;</span><span class="op">:</span> <span class="st">&quot;text/plain&quot;</span>})<span class="op">;</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>      response<span class="op">.</span><span class="fu">write</span>(<span class="st">&quot;404 Not found&quot;</span>)<span class="op">;</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>      response<span class="op">.</span><span class="fu">end</span>()<span class="op">;</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> port <span class="op">=</span> <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">port</span> <span class="op">||</span> <span class="dv">8080</span><span class="op">;</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  http<span class="op">.</span><span class="fu">createServer</span>(onRequest)<span class="op">.</span><span class="fu">listen</span>(port)<span class="op">;</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Has been started.&quot;</span>)<span class="op">;</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>exports<span class="op">.</span><span class="at">start</span> <span class="op">=</span> start<span class="op">;</span></span></code></pre></div>
<h3 id="the-node.js-system">3.3 The Node.js system</h3>
<figure>
<img src="./img/nodejs-system.jpg" alt="The Node.js system" />
<figcaption aria-hidden="true">The Node.js system</figcaption>
</figure>
<ul>
<li><strong>Engine</strong>: executes the code</li>
<li><strong>Event Loop</strong>: Everything that happens in Node is a
reaction to an event. Only one thread executes code, the thread where
the event loop is running.
<ol type="1">
<li><strong>Timers</strong>: Executes callbacks scheduled by
<code>setTimeout()</code> or <code>setInterval()</code></li>
<li><strong>I/O Callbacks</strong>: Handle I/O-related callbacks</li>
<li><strong>Poll</strong>: Retrieve new I/O events</li>
<li><strong>Check</strong>: Execute <code>setImmediate()</code>
callbacks</li>
<li><strong>Close Callbacks</strong>: Executes close event callbacks
(<code>socket.on('close',...)</code>)</li>
</ol></li>
</ul>
<blockquote>
<p>âš ï¸: Because of Node.js concurrency model, itâ€™s important to never
block the event loop, instead, use callbacks and asynchronous
methods.</p>
</blockquote>
<h3 id="express.js">3.4 Express.js</h3>
<p>Express is a framework for Node.js that makes it easier to build
RESTful APIs. A significant part of Express revolves around
<strong>middleware</strong>.</p>
<dl>
<dt><strong>Middleware</strong></dt>
<dd>
software component that sits between a client and a server, intercepting
and processing HTTP requests and responses. Itâ€™s a common pattern in web
development used to perform various tasks like authentication, logging,
request parsing, error handling, and more.
</dd>
</dl>
<figure>
<img src="./img/express-framework.png"
alt="Structure of Express application" />
<figcaption aria-hidden="true">Structure of Express
application</figcaption>
</figure>
<h4 id="demo">Demo</h4>
<p>app.js</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> express <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;express&#39;</span>) <span class="co">// Module</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> path <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;path&#39;</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> logger <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;morgan&#39;</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> bodyParser <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;body-parser&#39;</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> routes <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;./routes/index&#39;</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> users <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;./routes/users&#39;</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> app <span class="op">=</span> <span class="fu">express</span>()</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">//Views</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;views&#39;</span><span class="op">,</span> path<span class="op">.</span><span class="fu">join</span>(<span class="bu">__dirname</span><span class="op">,</span> <span class="st">&#39;views&#39;</span>))</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;view engine&#39;</span><span class="op">,</span> <span class="st">&#39;pug&#39;</span>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Middleware</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="fu">logger</span>(<span class="st">&#39;dev&#39;</span>))</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(bodyParser<span class="op">.</span><span class="fu">json</span>())</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(bodyParser<span class="op">.</span><span class="fu">urlencoded</span>({ <span class="dt">extended</span><span class="op">:</span> <span class="kw">false</span> }))</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co">// Routes</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="st">&#39;/&#39;</span><span class="op">,</span> routes)<span class="op">;</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="st">&#39;/users&#39;</span><span class="op">,</span> users)<span class="op">;</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="co">// error handler</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>( (err<span class="op">,</span> req<span class="op">,</span> res<span class="op">,</span> next) <span class="kw">=&gt;</span> {</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="at">locals</span><span class="op">.</span><span class="at">message</span> <span class="op">=</span> err<span class="op">.</span><span class="at">message</span><span class="op">;</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="at">locals</span><span class="op">.</span><span class="at">error</span> <span class="op">=</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>  req<span class="op">.</span><span class="at">app</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;env&#39;</span>) <span class="op">===</span> <span class="st">&#39;development&#39;</span> <span class="op">?</span> err <span class="op">:</span> {}<span class="op">;</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="fu">status</span>(err<span class="op">.</span><span class="at">status</span> <span class="op">||</span> <span class="dv">500</span>)<span class="op">;</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="fu">render</span>(<span class="st">&#39;error&#39;</span>)<span class="op">;</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>module<span class="op">.</span><span class="at">exports</span> <span class="op">=</span> app<span class="op">;</span></span></code></pre></div>
<p>routes/index.js</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>let express <span class="op">=</span> <span class="fu">require</span><span class="op">(</span><span class="er">&#39;</span>express<span class="er">&#39;</span><span class="op">);</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>let router <span class="op">=</span> express<span class="op">.</span><span class="fu">Router</span><span class="op">();</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>router<span class="op">.</span><span class="fu">get</span><span class="op">(</span><span class="ch">&#39;/&#39;</span><span class="op">,</span> <span class="op">(</span>req<span class="op">,</span> res<span class="op">,</span> next<span class="op">)</span> <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="fu">render</span><span class="op">(</span><span class="er">&#39;</span>index<span class="er">&#39;</span><span class="op">,</span> <span class="op">{</span> title<span class="op">:</span> <span class="er">&#39;</span>Express<span class="er">&#39;</span> <span class="op">});</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>module<span class="op">.</span><span class="fu">exports</span> <span class="op">=</span> router<span class="op">;</span></span></code></pre></div>
<hr />
<h2 id="websockets">4. Websockets</h2>
<dl>
<dt><strong>Websocket</strong></dt>
<dd>
Websockets is a communication protocol that provides full-duplex,
persistent, communication channels over a single, long-lived TCP
connection. Itâ€™s designed to enable real-time communication between a
client, typically a web browser, and a server.
</dd>
</dl>
<p>WS client example:</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> ws <span class="op">=</span> <span class="kw">new</span> <span class="bu">WebSocket</span>(<span class="st">&quot;ws://www.websockets.org&quot;</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Open connection</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>ws<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;open&#39;</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> { ws<span class="op">.</span><span class="fu">send</span>(<span class="st">&quot;Hello server!&quot;</span>) })</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Listen for incoming messages</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>ws<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;message&#39;</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> { <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="bu">event</span><span class="op">.</span><span class="at">data</span>) })</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Send a message</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>ws<span class="op">.</span><span class="fu">send</span>(<span class="st">&quot;Hello&quot;</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Server closes connection</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>ws<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;close&#39;</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> { <span class="fu">alert</span>(<span class="st">&quot;closed&quot;</span>) })</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Client closes connection</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>ws<span class="op">.</span><span class="fu">close</span>()</span></code></pre></div>
<p>Before websockets, clients used <code>polling</code> to achieve the
same functionality. Websockets, however, have less latency and less
overhead which makes the way more efficient.</p>
<figure>
<img src="./img/ws-vs-polling.png" alt="Websocket vs Polling" />
<figcaption aria-hidden="true">Websocket vs Polling</figcaption>
</figure>
<hr />
<h2 id="reactive-rest-webservices">5. Reactive REST webservices</h2>
<dl>
<dt><strong>Reactive programming</strong></dt>
<dd>
programming paradigm focused on building asynchronous and event-driven
applications. At its core, reactive programming revolves around the idea
of handling data flows and sequences of events with a focus on reacting
to changes.
</dd>
</dl>
<h3 id="data-streams">5.1 Data streams</h3>
<p>Streams allow for requested data to be send as it comes. Parts of the
data can already be send while other parts have not been loaded into
memory yet. This is done by creating a <strong>pipeline</strong> that
subscribes to any incoming data, processes the data, and then publishes
it.</p>
<p>Traditional methods required the application to store requests in
memory. If the size of the required data is larger than the available
memory, an â€œout of memoryâ€ error will occur.</p>
<figure>
<img src="./img/reactive-data-streams.png"
alt="Traditional vs stream" />
<figcaption aria-hidden="true">Traditional vs stream</figcaption>
</figure>
<h3 id="observer-and-observables">5.2 Observer and observables</h3>
<p>Central to reactive programming are observables (or streams) that
emit/push values or events and observers (or subscribers) that react to
these emissions. Observers can subscribe to observables to receive and
handle emitted values asynchronously.</p>
<dl>
<dt><strong>Backpressure</strong></dt>
<dd>
When a data provider pushes more data to a client than it can handle.
This problem is solved by making the client pull available data, so it
can decide on how fast it receives data.
</dd>
</dl>
<figure>
<img src="./img/backpressure-solution.png"
alt="Solution to backpressure" />
<figcaption aria-hidden="true">Solution to backpressure</figcaption>
</figure>
<h3 id="reactor-java">5.3 Reactor Java</h3>
<figure>
<img src="./img/reactive-stream-java.png"
alt="Reactive streams in Java" />
<figcaption aria-hidden="true">Reactive streams in Java</figcaption>
</figure>
<p>To efficiently program reactive applications, the <a
href="https://projectreactor.io/">reactor</a> library is often used.</p>
<h4 id="reactor---flux">Reactor - Flux</h4>
<p>A <code>Flux</code> is used to emit multiple values (asynchronously)
over time.</p>
<h4 id="reactor---mono">Reactor - Mono</h4>
<p>A <code>Mono</code> is a kind of flux that can send only one element
or none at all.</p>
<h4 id="reactive-stack-vs-servlet-stack">Reactive stack vs Servlet
stack</h4>
<table>
<colgroup>
<col style="width: 51%" />
<col style="width: 48%" />
</colgroup>
<thead>
<tr class="header">
<th>Reactive Stack</th>
<th>Servlet Stack</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Spring security reactive</td>
<td>Spring Security</td>
</tr>
<tr class="even">
<td>Spring WebFlux</td>
<td>Spring MVC</td>
</tr>
<tr class="odd">
<td>Spring reactive repos: Mongo, Redis, â€¦</td>
<td>Spring data repos: JDBC, JPA, NoSQL</td>
</tr>
</tbody>
</table>
<h4 id="example">Example</h4>
<p>Reactive DAO</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Service</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> SampleDAO<span class="op">{</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> <span class="bu">Random</span> random <span class="op">=</span> <span class="kw">new</span> <span class="bu">Random</span><span class="op">();</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">String</span><span class="op">[]</span> ids <span class="op">=</span> <span class="op">{</span><span class="st">&quot;S1&quot;</span><span class="op">,</span> <span class="st">&quot;S2&quot;</span><span class="op">,</span> <span class="st">&quot;S3&quot;</span><span class="op">};</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> Flux<span class="op">&lt;</span>Sample<span class="op">&gt;</span> <span class="fu">getSamples</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Flux<span class="op">.</span><span class="fu">interval</span><span class="op">(</span><span class="bu">Duration</span><span class="op">.</span><span class="fu">ofSeconds</span><span class="op">(</span><span class="dv">1</span><span class="op">)).</span><span class="fu">take</span><span class="op">(</span><span class="dv">10</span><span class="op">)</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span><span class="op">(</span>pulse <span class="op">-&gt;</span> <span class="fu">getSample</span><span class="op">());</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> Sample <span class="fu">getSample</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  Sample s <span class="op">=</span> <span class="kw">new</span> <span class="fu">Sample</span><span class="op">();</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  s<span class="op">.</span><span class="fu">setId</span><span class="op">(</span>ids<span class="op">[</span>random<span class="op">.</span><span class="fu">nextInt</span><span class="op">(</span>ids<span class="op">.</span><span class="fu">length</span><span class="op">)]);</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  s<span class="op">.</span><span class="fu">setTime</span><span class="op">(</span>LocalDateTime<span class="op">.</span><span class="fu">now</span><span class="op">());</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  s<span class="op">.</span><span class="fu">setValue</span><span class="op">(</span><span class="fl">4882.42</span><span class="op">);</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> s<span class="op">;</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Reactive controller</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="at">@RestController</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="at">@RequestMapping</span><span class="op">(</span><span class="st">&quot;samples&quot;</span><span class="op">)</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> SampleController <span class="op">{</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> SampleDAO dao<span class="op">;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">SampleController</span><span class="op">(</span>SampleDAO dao<span class="op">)</span> <span class="op">{</span> <span class="kw">this</span><span class="op">.</span><span class="fu">dao</span> <span class="op">=</span> dao<span class="op">;</span> <span class="op">}</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">@GetMapping</span><span class="op">(</span><span class="st">&quot;sample&quot;</span><span class="op">)</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> Flux<span class="op">&lt;</span>Sample<span class="op">&gt;</span> <span class="fu">getSamples</span><span class="op">()</span> <span class="op">{</span> <span class="cf">return</span> dao<span class="op">.</span><span class="fu">getSamples</span><span class="op">();</span> <span class="op">}</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Reactive client</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> ClientTestWebflux <span class="op">{</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="dt">void</span> <span class="fu">testServer</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    WebClient client <span class="op">=</span> WebClient<span class="op">.</span><span class="fu">create</span><span class="op">(</span><span class="st">&quot;http://localhost:8080&quot;</span><span class="op">);</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    Flux<span class="op">&lt;</span>Sample<span class="op">&gt;</span> sampleFlux <span class="op">=</span> client<span class="op">.</span><span class="fu">get</span><span class="op">()</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">uri</span><span class="op">(</span><span class="st">&quot;/samples&quot;</span><span class="op">)</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">retrieve</span><span class="op">()</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">bodyToFlux</span><span class="op">(</span>Sample<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    sampleFlux<span class="op">.</span><span class="fu">subscribe</span><span class="op">(</span><span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">::</span>println<span class="op">);</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">&quot;in test webflux&quot;</span><span class="op">);</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<hr />
<h2 id="jdbc">6. JDBC</h2>
<dl>
<dt><strong>JDBC (Java Database Connectivity API)</strong></dt>
<dd>
An API that allows Java applications to interact with databases.
</dd>
</dl>
<ul>
<li>Accesses SQL-compatible relational databases from Java
application</li>
<li>Can perform SQL-queries and process data</li>
<li>Abstraction for common database functions</li>
<li>Same application should work on different databases (no need to
rewrite backend)</li>
</ul>
<h3 id="jdbc-drivers">6.1 JDBC drivers</h3>
<figure>
<img src="./img/JDBC-drivers.png" alt="JDBC driver types" />
<figcaption aria-hidden="true">JDBC driver types</figcaption>
</figure>
<h3 id="jdbc-example">6.2 JDBC Example</h3>
<h4 id="configuration">Configuration</h4>
<p>db_constants.properties</p>
<pre class="text"><code># info databank
username=TLuca
password=&lt;redacted&gt;
driver=org.postgresql.Driver
connectionstring=jdbc:postgresql://localhost:5432/db_name

#Constanten for table products
Q_select_products=select * from products
Q_select_product=select * from products where productCode = ?

# Mappings to column names
prod_code=productCode
prod_name=productName
prod_price=buyPrice
prod_msrp=MSRP</code></pre>
<h4 id="making-connection">Making connection</h4>
<div class="sourceCode" id="cb29"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Component</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="at">@PropertySource</span><span class="op">(</span><span class="st">&quot;classpath:databankconstanten.properties&quot;</span><span class="op">)</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> JDBCDataStorage <span class="kw">implements</span> IDataStorage <span class="op">{</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Value</span><span class="op">(</span><span class="st">&quot;${connectionstring}&quot;</span><span class="op">)</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">String</span> connString<span class="op">;</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Value</span><span class="op">(</span><span class="st">&quot;${username}&quot;</span><span class="op">)</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">String</span> login<span class="op">;</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Value</span><span class="op">(</span><span class="st">&quot;${password}&quot;</span><span class="op">)</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">String</span> password<span class="op">;</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Columns</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Value</span><span class="op">(</span><span class="st">&quot;${prod_code}&quot;</span><span class="op">)</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">String</span> prodCode<span class="op">;</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Value</span><span class="op">(</span><span class="st">&quot;${prod_name}&quot;</span><span class="op">)</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">String</span> prodName<span class="op">;</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Value</span><span class="op">(</span><span class="st">&quot;${prod_price}&quot;</span><span class="op">)</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">String</span> prodPrice<span class="op">;</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Value</span><span class="op">(</span><span class="st">&quot;${prod_msrp}&quot;</span><span class="op">)</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">String</span> prodMsrp<span class="op">;</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">// SQL-queries</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Value</span><span class="op">(</span><span class="st">&quot;${Q_select_products}&quot;</span><span class="op">)</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">String</span> selectProducts<span class="op">;</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">DataSource</span> dataSource<span class="op">;</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">@Autowired</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setDataSource</span><span class="op">(</span><span class="bu">DataSource</span> dataSource<span class="op">)</span> <span class="op">{</span></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">dataSource</span> <span class="op">=</span> dataSource<span class="op">;</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="bu">Connection</span> <span class="fu">openConnectie</span><span class="op">()</span> <span class="kw">throws</span> <span class="bu">SQLException</span> <span class="op">{</span></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> dataSource<span class="op">.</span><span class="fu">getConnection</span><span class="op">();</span></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="performing-actions-get-on-database">Performing actions (GET) on
database</h4>
<div class="sourceCode" id="cb30"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="bu">List</span><span class="op">&lt;</span>IProduct<span class="op">&gt;</span> <span class="fu">getProducts</span><span class="op">()</span> <span class="kw">throws</span> DataException <span class="op">{</span> <span class="co">// DataException is custom class</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">List</span><span class="op">&lt;</span>IProduct<span class="op">&gt;</span> products<span class="op">;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> <span class="op">(</span><span class="bu">Connection</span> conn <span class="op">=</span> <span class="fu">openConnectie</span><span class="op">();</span> <span class="bu">Statement</span> stmt <span class="op">=</span> conn<span class="op">.</span><span class="fu">createStatement</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span>conn<span class="op">.</span><span class="fu">getClass</span><span class="op">());</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span>stmt<span class="op">.</span><span class="fu">getClass</span><span class="op">());</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">ResultSet</span> rs <span class="op">=</span> stmt<span class="op">.</span><span class="fu">executeQuery</span><span class="op">(</span>selectProducts<span class="op">);</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span>rs<span class="op">.</span><span class="fu">getClass</span><span class="op">());</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    products <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>rs<span class="op">.</span><span class="fu">next</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>      products<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="fu">createProduct</span><span class="op">(</span>rs<span class="op">));</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="bu">SQLException</span> ex<span class="op">)</span> <span class="op">{</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">DataExceptie</span><span class="op">(</span>foutProducts<span class="op">);</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> products<span class="op">;</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="sql-injection">6.3 SQL-injection</h3>
<p>When using prepared statements, we possibly expose the application to
SQL-injection. We can defend ourself against this vulnerability by
working with parameters:</p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> username <span class="op">=</span> <span class="fu">getUserInput</span><span class="op">();</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> sql <span class="op">=</span> <span class="st">&quot;SELECT * FROM users WHERE username = ?&quot;</span><span class="op">;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="bu">PreparedStatement</span> preparedStatement <span class="op">=</span> connection<span class="op">.</span><span class="fu">prepareStatement</span><span class="op">(</span>sql<span class="op">);</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>preparedStatement<span class="op">.</span><span class="fu">setString</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span> username<span class="op">);</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="bu">ResultSet</span> resultSet <span class="op">=</span> preparedStatement<span class="op">.</span><span class="fu">executeQuery</span><span class="op">();</span></span></code></pre></div>
<h3 id="driver-vs-datasource">6.4 Driver vs DataSource</h3>
<p><strong>DataSource</strong>:</p>
<ul>
<li>Spring</li>
<li>Represents a DBMS</li>
<li>Available through dependency injection or JNDI</li>
<li>Safer than driver: No configuration in code.</li>
</ul>
<h3 id="orm-v-jdbc">6.5 ORM v JDBC</h3>
<ul>
<li>JDBC/ADO.NET:
<ul>
<li>Time-intensive</li>
<li>Low-level data-access</li>
</ul></li>
<li>ORM
<ul>
<li>Defining a mapping with annotations</li>
<li>Less performant</li>
<li>Faster dev time</li>
</ul></li>
</ul>
<hr />
            </div>
    </div>
  </div>
  <script src="https://vjs.zencdn.net/5.4.4/video.js"></script>

</body>
</html>
